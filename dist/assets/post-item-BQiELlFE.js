import{i as u,g as m,s as l}from"./auth-JaHXRiaM.js";/* empty css              */import"./admin-Dyf5zH3X.js";let a=[];document.addEventListener("DOMContentLoaded",async()=>{if(!await u()){window.location.href="index.html";return}g()});function g(){const n=document.getElementById("imageInput");document.getElementById("imageGrid");const i=document.getElementById("postItemForm");document.querySelector(".logout-btn"),n.addEventListener("change",r=>{const e=Array.from(r.target.files);if(a.length+e.length>5){alert("You can only upload up to 5 images.");return}e.forEach(t=>{a.push(t),p(t)}),n.value=""}),i.addEventListener("submit",async r=>{r.preventDefault();const e=document.getElementById("submitBtn");e.disabled=!0,e.textContent="Posting...";try{const t=await m();if(!t)throw new Error("Authentication required");const o=await f(t.id),s={seller_id:t.id,seller_public_id:t.publicUserId||null,title:document.getElementById("title").value,description:document.getElementById("description").value,price:parseFloat(document.getElementById("price").value),category:document.getElementById("category").value,image_url:o[0]||null,images:o,status:"active"},{data:c,error:d}=await l.from("market_listings").insert([s]).select();if(d)throw d;alert("Item posted successfully!"),window.location.href="listings.html"}catch(t){console.error("Post error:",t),alert(`Error: ${t.message}`),e.disabled=!1,e.textContent="List Item Now"}})}function p(n){const i=document.getElementById("imageGrid"),r=document.getElementById("uploadBtn"),e=document.createElement("div");e.className="image-preview-box";const t=document.createElement("img");t.src=URL.createObjectURL(n);const o=document.createElement("button");o.className="remove-img",o.textContent="Ã—",o.onclick=()=>{a=a.filter(s=>s!==n),e.remove()},e.appendChild(t),e.appendChild(o),i.insertBefore(e,r)}async function f(n){const i=[];for(const r of a){const e=r.name.split(".").pop(),t=`${Date.now()}_${Math.random().toString(36).substring(7)}.${e}`,o=`${n}/${t}`,{error:s}=await l.storage.from("listing-images").upload(o,r);if(s)throw s;const{data:{publicUrl:c}}=l.storage.from("listing-images").getPublicUrl(o);i.push(c)}return i}(async()=>{const n=await m();(!n||n.role!=="seller")&&(window.location.href="index.html")})();
//# sourceMappingURL=post-item-BQiELlFE.js.map
