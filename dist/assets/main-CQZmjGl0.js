import{i as c,s as l,g as w,l as k,r as M,a as C}from"./auth-DlafXHy2.js";/* empty css               */import{i as b}from"./navbar-CyDIn5Kq.js";import{i as A,f as S,c as m}from"./save-item-BNnOAKNn.js";let u="all",E=[];const f=document.getElementById("uploadModal");document.getElementById("resourceModal");const g=document.getElementById("authModal");document.getElementById("postItemBtn");document.getElementById("uploadResourceBtn");document.getElementById("uploadForm");const p=document.getElementById("resourceForm"),y=document.getElementById("loginForm"),v=document.getElementById("registerForm"),T=document.getElementById("searchInput"),a=document.getElementById("marketplaceGrid"),i=document.getElementById("resourcesGrid");document.getElementById("loginBtn");document.getElementById("dashboardLink");document.addEventListener("DOMContentLoaded",async()=>{if(await b(),await H(),await c()){window.location.href="admin.html";return}I(),B(),A(),new URLSearchParams(window.location.search).get("action")==="post"&&setTimeout(()=>{document.dispatchEvent(new CustomEvent("open-post-modal"))},800),_(),l.auth.onAuthStateChange((e,t)=>{e==="SIGNED_OUT"?window.location.href="index.html":e==="SIGNED_IN"&&window.location.pathname.endsWith("index.html")&&(window.location.href="admin.html")})});async function H(){const o=await w(),n=document.getElementById("heroAuthCtas");o?n&&(n.style.display="none"):(n&&(n.style.display="flex"),x())}function x(){const o=document.getElementById("heroSignupBtn"),n=document.getElementById("heroLoginBtn"),e=document.getElementById("authModal");o&&e&&(o.onclick=()=>{var t;(t=document.querySelector('.auth-tab[data-tab="register"]'))==null||t.click(),e.classList.add("active")}),n&&(n.onclick=()=>{const t=document.getElementById("marketplace");t&&t.scrollIntoView({behavior:"smooth"})})}async function I(){const o=await c(),n=await S();a&&(n&&n.length>0?a.innerHTML=n.map(e=>m(e,o)).join(""):a.innerHTML='<p class="empty-state">No items found. Be the first to post!</p>')}document.addEventListener("item-posted",I);async function B(){if(i)try{const{data:o,error:n}=await l.from("free_resources").select("*").order("created_at",{ascending:!1});if(n)throw n;E=o||[],L()}catch(o){console.error("Error fetching resources:",o.message),i.innerHTML='<p class="error-state">Failed to load resources.</p>'}}function L(){if(!i)return;const o=E.filter(n=>u==="all"?!0:n.type===u);if(o.length===0){i.innerHTML='<p class="empty-state">No resources found.</p>';return}i.innerHTML=o.map(n=>F(n)).join("")}function F(o){const n={exam:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/></svg>',textbook:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor" stroke-width="2"/></svg>',notes:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke="currentColor" stroke-width="2"/></svg>'};return`
        <div class="resource-card" data-id="${o.id}">
            <div class="resource-header">
                <div class="resource-icon">
                    ${n[o.type]||n.exam}
                </div>
                <div class="resource-info">
                    <span class="resource-type">${o.type}</span>
                    <h3 class="resource-title">${o.title}</h3>
                    <p class="resource-course">${o.course}</p>
                </div>
            </div>
            <div class="resource-meta">
                <span class="resource-year">${o.year}</span>
                <button class="download-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 11V3M8 11L5 8M8 11L11 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 13H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Download
                </button>
            </div>
        </div>
    `}function _(){const o=document.getElementById("navSearchInput")||T;o&&o.addEventListener("input",q($,300)),document.querySelectorAll(".category-chip").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".category-chip").forEach(s=>s.classList.remove("active")),e.classList.add("active");const t=e.dataset.category;N(t)})}),document.querySelectorAll(".resource-chip").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".resource-chip").forEach(t=>t.classList.remove("active")),e.classList.add("active"),u=e.dataset.type,L()})}),y&&y.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("loginEmail").value,s=document.getElementById("loginPassword").value,r=await k(t,s);r.success?window.location.href="admin.html":alert(r.message)}),v&&v.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("registerName").value,s=document.getElementById("registerEmail").value,r=document.getElementById("registerPassword").value,d=document.getElementById("registerRole").value,h=await M(s,r,t,d);h.success?window.location.href="admin.html":alert(h.message)}),p&&p.addEventListener("submit",D),a&&a.addEventListener("click",async e=>{const t=e.target.closest("button");if(!t)return;const s=t.dataset.action,r=t.dataset.id;if(s==="buy")window.location.href=`payment.html?item_id=${r}`;else if(s==="contact"){const d=t.dataset.sellerId;window.location.href=`messages.html?partner_id=${d}`}else s==="view"&&(await c()?window.location.href=`item.html?id=${r}`:document.dispatchEvent(new CustomEvent("open-auth-modal")))}),i&&i.addEventListener("click",e=>{const t=e.target.closest(".download-btn");if(t){const s=t.closest(".resource-card");s&&R(s.dataset.id)}}),document.addEventListener("open-auth-modal",()=>{g&&g.classList.add("active")}),document.addEventListener("open-post-modal",()=>{f&&f.classList.add("active")}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".modal").forEach(t=>t.classList.remove("active"))})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.remove("active")});const n=document.querySelectorAll(".auth-tab");n.forEach(e=>{e.addEventListener("click",()=>{n.forEach(s=>s.classList.remove("active")),e.classList.add("active"),e.dataset.tab==="login"?(document.getElementById("loginForm").style.display="block",document.getElementById("registerForm").style.display="none",document.getElementById("authModalTitle").textContent="Login"):(document.getElementById("loginForm").style.display="none",document.getElementById("registerForm").style.display="block",document.getElementById("authModalTitle").textContent="Register")})})}async function D(o){if(o.preventDefault(),!await c()){alert("Please login to upload resources.");return}const n=await w(),e={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,course:document.getElementById("resourceCourse").value,year:parseInt(document.getElementById("resourceYear").value)||new Date().getFullYear(),description:document.getElementById("resourceDescription").value,uploader_id:n.id},{error:t}=await l.from("free_resources").insert([e]);t?alert("Error uploading resource: "+t.message):(alert("Resource uploaded!"),document.getElementById("resourceModal").classList.remove("active"),B())}async function R(o){if(!await c()){document.dispatchEvent(new CustomEvent("open-auth-modal"));return}await C({id:o}),alert("Download started!")}function q(o,n){let e;return function(...t){clearTimeout(e),e=setTimeout(()=>o.apply(this,t),n)}}async function $(o){const n=o.target.value.toLowerCase(),{data:e,error:t}=await l.from("market_listings").select(`
            *,
            profiles (
                username,
                full_name
            )
        `).or(`title.ilike.%${n}%,description.ilike.%${n}%`).eq("status","active");t&&console.error("Search error:",t);const s=await c();a&&(a.innerHTML=(e||[]).map(r=>m(r,s)).join(""))}async function N(o){const n=await c(),{data:e,error:t}=await l.from("market_listings").select(`
            *,
            profiles (
                username,
                full_name
            )
        `).eq("status","active").order("created_at",{ascending:!1});t&&console.error("Filter error:",t);const s=o==="all"?e:(e||[]).filter(r=>r.category===o);a&&(a.innerHTML=(s||[]).map(r=>m(r,n)).join(""))}
