{"version":3,"file":"item-tjMknBZ4.js","sources":["../../item.html?html-proxy&index=1.js"],"sourcesContent":["\n        import { supabase } from './supabase-config.js';\n        import { getCurrentUser } from './auth.js';\n\n        document.addEventListener('DOMContentLoaded', async () => {\n            const urlParams = new URLSearchParams(window.location.search);\n            const itemId = urlParams.get('id');\n\n            if (!itemId) {\n                window.location.href = 'listings.html';\n                return;\n            }\n\n            renderItemDetails(itemId);\n        });\n\n        async function renderItemDetails(id) {\n            const container = document.getElementById('itemDetailContainer');\n\n            try {\n                // Fetch item with profile join\n                const { data: item, error } = await supabase\n                    .from('market_listings')\n                    .select(`\n                        *,\n                        profiles (\n                            username,\n                            full_name,\n                            avatar_url,\n                            immutable_user_code\n                        )\n                    `)\n                    .eq('id', id)\n                    .single();\n\n                if (error || !item) throw new Error('Item not found or has been removed.');\n\n                // Consolidate images: prioritize image_url, then images array\n                let images = [];\n                if (item.image_url) images.push(item.image_url);\n                if (item.images && Array.isArray(item.images)) {\n                    item.images.forEach(img => {\n                        if (img && !images.includes(img)) images.push(img);\n                    });\n                }\n                if (images.length === 0) images.push('https://via.placeholder.com/600x400?text=No+Image');\n\n                const mainImage = images[0];\n                const sellerName = item.profiles?.username || item.profiles?.full_name || 'Anonymous Seller';\n                const sellerId = item.profiles?.immutable_user_code || item.seller_id.slice(0, 6).toUpperCase();\n                const sellerAvatar = item.profiles?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(sellerName)}&background=368CBF&color=fff`;\n\n                // Build Thumbnails HTML\n                let thumbnailsHtml = '';\n                if (images.length > 1) {\n                    thumbnailsHtml = `<div class=\"detail-thumbnails\">` +\n                        images.map((img, index) => `\n                            <img src=\"${img}\" \n                                 class=\"thumbnail-img ${index === 0 ? 'active' : ''}\" \n                                 onclick=\"changeMainImage('${img}', this)\"\n                                 alt=\"Thumbnail ${index + 1}\">\n                        `).join('') +\n                        `</div>`;\n                }\n\n                container.innerHTML = `\n                    <div class=\"item-detail-container\">\n                        <div class=\"detail-visuals\">\n                            <img src=\"${mainImage}\" alt=\"${item.title}\" class=\"detail-main-img\" id=\"mainImageDisplay\">\n                            ${thumbnailsHtml}\n                        </div>\n                        <div class=\"detail-info-panel\">\n                            <span class=\"detail-category\">${item.category || 'MARKETPLACE'}</span>\n                            <h1 class=\"detail-title\">${item.title}</h1>\n                            \n                            <div class=\"detail-price-box\">\n                                <span class=\"detail-currency\">R</span>\n                                <span class=\"detail-price\">${parseFloat(item.price).toLocaleString()}</span>\n                            </div>\n\n                            <div class=\"detail-section\">\n                                <h4>Description</h4>\n                                <div class=\"detail-description\">\n                                    ${item.description || 'No description provided.'}\n                                </div>\n                            </div>\n\n                            <div class=\"detail-section\">\n                                <h4>Listing Details</h4>\n                                <p style=\"font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem;\">\n                                    <strong>Status:</strong> <span class=\"status-tag active\" style=\"font-size: 0.7rem;\">${item.status.toUpperCase()}</span>\n                                </p>\n                                <p style=\"font-size: 0.9rem; color: var(--text-muted);\">\n                                    <strong>Posted:</strong> ${new Date(item.created_at).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}\n                                </p>\n                            </div>\n\n                            <div class=\"detail-seller-card\">\n                                <img src=\"${sellerAvatar}\" class=\"seller-avatar\">\n                                <div class=\"seller-meta-info\">\n                                    <span class=\"name\">${sellerName}</span>\n                                    <span class=\"id\">User ID: #${sellerId}</span>\n                                </div>\n                            </div>\n\n                            <div class=\"detail-actions-grid\">\n                                <button class=\"btn-primary\" onclick=\"window.handleBuyAction('${item.id}')\" style=\"width: 100%; height: 48px; border-radius: 12px; font-weight: 700;\">Buy Now</button>\n                                <button class=\"btn-secondary\" onclick=\"window.handleContactAction('${item.seller_id}', '${item.id}')\" style=\"width: 100%; height: 48px; border-radius: 12px; font-weight: 700; background: transparent; color: var(--primary-color); border: 2px solid var(--primary-color);\">Contact Seller</button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n            } catch (err) {\n                console.error('Render error:', err);\n                container.innerHTML = `\n                    <div class=\"p-12 text-center\">\n                        <div style=\"font-size: 3rem; margin-bottom: 1rem;\">‚ùå</div>\n                        <h3 style=\"font-weight: 800; font-size: 1.5rem; margin-bottom: 0.5rem;\">Oops!</h3>\n                        <p style=\"color: var(--text-muted);\">${err.message}</p>\n                        <a href=\"listings.html\" class=\"btn-primary\" style=\"display: inline-block; margin-top: 2rem; padding: 0.75rem 2rem; text-decoration: none; border-radius: 10px;\">Back to Marketplace</a>\n                    </div>\n                `;\n            }\n        }\n\n        window.changeMainImage = (src, thumbEl) => {\n            const mainImg = document.getElementById('mainImageDisplay');\n            if (mainImg) {\n                mainImg.src = src;\n                // Update active state\n                document.querySelectorAll('.thumbnail-img').forEach(el => el.classList.remove('active'));\n                if (thumbEl) thumbEl.classList.add('active');\n            }\n        };\n\n        window.handleBuyAction = (itemId) => {\n            window.location.href = `checkout.html?id=${itemId}`;\n        };\n\n        window.handleContactAction = (sellerId, listingId) => {\n            window.location.href = `messages.html?seller_id=${sellerId}&listing_id=${listingId}`;\n        };\n    "],"names":["itemId","renderItemDetails","id","container","item","error","supabase","images","img","mainImage","sellerName","_a","_b","sellerId","_c","sellerAvatar","_d","thumbnailsHtml","index","err","src","thumbEl","mainImg","el","listingId"],"mappings":"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"}