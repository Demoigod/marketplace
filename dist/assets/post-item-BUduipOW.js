import{i as m,g as u,s as l}from"./auth-BNhlD6S9.js";/* empty css              */import"./admin-Bu9uiZ5z.js";let a=[];document.addEventListener("DOMContentLoaded",async()=>{if(!await m()){window.location.href="index.html";return}g()});function g(){const o=document.getElementById("imageInput");document.getElementById("imageGrid");const i=document.getElementById("postItemForm");document.querySelector(".logout-btn"),o.addEventListener("change",r=>{const e=Array.from(r.target.files);if(a.length+e.length>5){alert("You can only upload up to 5 images.");return}e.forEach(t=>{a.push(t),p(t)}),o.value=""}),i.addEventListener("submit",async r=>{r.preventDefault();const e=document.getElementById("submitBtn");e.disabled=!0,e.textContent="Posting...";try{const t=await u();if(!t)throw new Error("Authentication required");const n=await f(t.id),s={seller_id:t.id,seller_public_id:t.publicUserId||null,title:document.getElementById("title").value,description:document.getElementById("description").value,price:parseFloat(document.getElementById("price").value),category:document.getElementById("category").value,image_url:n[0]||null,images:n,status:"active"},{data:c,error:d}=await l.from("market_listings").insert([s]).select();if(d)throw d;alert("Item posted successfully!"),window.location.href="listings.html"}catch(t){console.error("Post error:",t),alert(`Error: ${t.message}`),e.disabled=!1,e.textContent="List Item Now"}})}function p(o){const i=document.getElementById("imageGrid"),r=document.getElementById("uploadBtn"),e=document.createElement("div");e.className="image-preview-box";const t=document.createElement("img");t.src=URL.createObjectURL(o);const n=document.createElement("button");n.className="remove-img",n.textContent="Ã—",n.onclick=()=>{a=a.filter(s=>s!==o),e.remove()},e.appendChild(t),e.appendChild(n),i.insertBefore(e,r)}async function f(o){const i=[];for(const r of a){const e=r.name.split(".").pop(),t=`${Date.now()}_${Math.random().toString(36).substring(7)}.${e}`,n=`${o}/${t}`,{error:s}=await l.storage.from("listing-images").upload(n,r);if(s)throw s;const{data:{publicUrl:c}}=l.storage.from("listing-images").getPublicUrl(n);i.push(c)}return i}
