import{i as l,g as d,s as i}from"./navbar-CpVXx8h8.js";async function u(o){if(!await l()){alert("Please log in to contact the seller."),document.dispatchEvent(new CustomEvent("open-auth-modal"));return}const t=await d();if(t){if(t.id===o){alert("You cannot message yourself about your own item.");return}try{const[e,a]=[t.id,o].sort();let{data:r,error:n}=await i.from("conversations").select("id").eq("user1_id",e).eq("user2_id",a).maybeSingle();if(n)throw n;if(!r){const{data:c,error:s}=await i.from("conversations").insert([{user1_id:e,user2_id:a}]).select().single();if(s)throw s;r=c}window.location.href=`chat.html?conversation_id=${r.id}`}catch(e){console.error("Messaging error:",e.message),alert("Could not start conversation: "+e.message)}}}window.handleContactAction=u;export{u as h};
