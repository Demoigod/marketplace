import{i as m,s as l,g as u,b as f}from"./auth-DlafXHy2.js";/* empty css              *//* empty css               */import{i as g,f as p,c as d}from"./save-item-BNnOAKNn.js";document.addEventListener("DOMContentLoaded",async()=>{if(!await m()){window.location.href="index.html";return}h(),y(),w(),g(),l.auth.onAuthStateChange(e=>{e==="SIGNED_OUT"&&(window.location.href="index.html")})});async function h(){const t=await u();if(t){const e=document.querySelectorAll(".admin-name"),o=t.username||t.full_name||"User";e.forEach(n=>n.textContent=o),document.querySelectorAll(".avatar").forEach(n=>{n.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(o)}&background=368CBF&color=fff`})}}async function y(){const t=document.getElementById("marketplaceGrid");if(t)try{const e=await p();console.log(`Loading ${(e==null?void 0:e.length)||0} items into grid...`);const o=!0;e&&e.length>0?(t.innerHTML=e.map(a=>d(a,o)).join(""),console.log("Grid updated successfully")):(console.log("No items found, showing empty state"),t.innerHTML='<div class="empty-state" style="padding: 60px; text-align: center; grid-column: 1/-1;"><p style="color: var(--text-secondary); font-size: 1.1rem;">No items found in the marketplace.</p></div>')}catch(e){console.error("Error loading marketplace:",e.message),t.innerHTML='<p class="error-state">Failed to load listings. Please try again later.</p>'}}function w(){const t=document.getElementById("listingsSearch");t&&t.addEventListener("input",v(async a=>{const n=a.target.value.toLowerCase(),i=document.getElementById("marketplaceGrid"),{data:r,error:s}=await l.from("market_listings").select(`
                    *,
                    profiles (
                        username,
                        full_name
                    )
                `).or(`title.ilike.%${n}%,description.ilike.%${n}%`).eq("status","active");s&&console.error("Search error:",s),i&&(i.innerHTML=(r||[]).map(c=>d(c,!0)).join(""))},300));const e=document.getElementById("marketplaceGrid");e&&e.addEventListener("click",async a=>{const n=a.target.closest("button");if(!n)return;const i=n.dataset.action,r=n.dataset.id;if(i==="buy")window.location.href=`payment.html?item_id=${r}`;else if(i==="contact"){const s=n.dataset.sellerId,c=n.dataset.id;window.location.href=`messages.html?partner_id=${s}&item_id=${c}`}else i==="view"&&(window.location.href=`item.html?id=${r}`)});const o=document.querySelector(".logout-btn");o&&o.addEventListener("click",async()=>{confirm("Are you sure you want to logout?")&&(await f(),window.location.href="index.html")})}function v(t,e){let o;return function(...a){clearTimeout(o),o=setTimeout(()=>t.apply(this,a),e)}}
