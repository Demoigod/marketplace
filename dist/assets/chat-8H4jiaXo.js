import{a as l,i as m,g,s as o}from"./navbar-BksK6sTH.js";/* empty css               */let a=null,i=null;document.addEventListener("DOMContentLoaded",async()=>{if(await l(),!await m()){window.location.href="index.html";return}if(i=await g(),a=new URLSearchParams(window.location.search).get("conversation_id"),!a){window.location.href="index.html";return}await u(),await v(),f(),document.getElementById("messageForm").addEventListener("submit",h),document.getElementById("backBtn").addEventListener("click",()=>{window.history.back()})});async function u(){try{const{data:e,error:t}=await o.from("conversations").select("*").eq("id",a).single();if(t)throw t;const n=e.user1_id===i.id?e.user2_id:e.user1_id,{data:s,error:r}=await o.from("users").select("name").eq("id",n).single();if(r)throw r;document.getElementById("chatPartnerName").textContent=s.name}catch(e){console.error("Error loading conversation details:",e.message)}}async function v(){const e=document.getElementById("messagesList");try{const{data:t,error:n}=await o.from("messages").select("*").eq("conversation_id",a).order("created_at",{ascending:!0});if(n)throw n;e.innerHTML="",t.length===0?e.innerHTML='<div class="empty-state">No messages yet. Say hello!</div>':t.forEach(s=>c(s)),d()}catch(t){e.innerHTML=`<div class="error-state">Error loading messages: ${t.message}</div>`}}function f(){o.channel(`chat:${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${a}`},e=>{c(e.new),d()}).subscribe()}async function h(e){e.preventDefault();const t=document.getElementById("messageInput"),n=t.value.trim();if(!(!n||!a)){t.value="";try{const{error:s}=await o.from("messages").insert([{conversation_id:a,sender_id:i.id,body:n}]);if(s)throw s}catch(s){alert("Failed to send message: "+s.message),t.value=n}}}function c(e){const t=document.getElementById("messagesList"),n=e.sender_id===i.id,s=t.querySelector(".empty-state");s&&s.remove();const r=document.createElement("div");r.className=`message-bubble ${n?"sent":"received"}`,r.innerHTML=`
        <div class="message-content">${w(e.body)}</div>
        <div class="message-time">${new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
    `,t.appendChild(r)}function d(){const e=document.getElementById("messagesList");e.scrollTop=e.scrollHeight}function w(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}
