import{a as l,i as m,g as u,s as o}from"./navbar-BksK6sTH.js";/* empty css               */let a=null,i=null;document.addEventListener("DOMContentLoaded",async()=>{if(await l(),!await m()){window.location.href="index.html";return}if(i=await u(),a=new URLSearchParams(window.location.search).get("conversation_id"),!a){window.location.href="index.html";return}await g(),await v(),h(),document.getElementById("messageForm").addEventListener("submit",f),document.getElementById("backBtn").addEventListener("click",()=>{window.history.back()})});async function g(){try{const{data:e,error:t}=await o.from("conversations").select("*").eq("id",a).single();if(t)throw t;const s=e.user1_id===i.id?e.user2_id:e.user1_id,{data:n,error:r}=await o.from("users").select("name").eq("id",s).single();r?(console.warn("Could not load partner name, using fallback"),document.getElementById("chatPartnerName").textContent="Chat Partner"):document.getElementById("chatPartnerName").textContent=n.name||"Chat Partner"}catch(e){throw console.error("Error loading conversation details:",e.message),document.getElementById("messagesList").innerHTML='<div class="error-state">Conversation not found or access denied.</div>',e}}async function v(){const e=document.getElementById("messagesList");try{const{data:t,error:s}=await o.from("messages").select("*").eq("conversation_id",a).order("created_at",{ascending:!0});if(s)throw s;e.innerHTML="",t.length===0?e.innerHTML='<div class="empty-state">No messages yet. Say hello!</div>':t.forEach(n=>c(n)),d()}catch(t){e.innerHTML=`<div class="error-state">Error loading messages: ${t.message}</div>`}}function h(){o.channel(`chat:${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${a}`},e=>{c(e.new),d()}).subscribe()}async function f(e){e.preventDefault();const t=document.getElementById("messageInput"),s=t.value.trim();if(!(!s||!a)){t.value="";try{const{error:n}=await o.from("messages").insert([{conversation_id:a,sender_id:i.id,body:s}]);if(n)throw n}catch(n){alert("Failed to send message: "+n.message),t.value=s}}}function c(e){const t=document.getElementById("messagesList"),s=e.sender_id===i.id,n=t.querySelector(".empty-state");n&&n.remove();const r=document.createElement("div");r.className=`message-bubble ${s?"sent":"received"}`,r.innerHTML=`
        <div class="message-content">${y(e.body)}</div>
        <div class="message-time">${new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>
    `,t.appendChild(r)}function d(){const e=document.getElementById("messagesList");e.scrollTop=e.scrollHeight}function y(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}
