import{i as $,s as f,g as h,b as _}from"./auth-C6Z0jTos.js";/* empty css              */let w=[],p="all";document.addEventListener("DOMContentLoaded",async()=>{if(!await $()){window.location.href="index.html";return}F(),await I(),U(),f.auth.onAuthStateChange(t=>{t==="SIGNED_OUT"&&(window.location.href="index.html")})});async function F(){const e=await h();e&&(document.querySelectorAll(".admin-name").forEach(i=>i.textContent=e.name||"User"),document.querySelectorAll(".avatar").forEach(i=>{i.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(e.name||"User")}&background=368CBF&color=fff`}))}async function I(){const e=document.getElementById("resourcesGrid");if(e)try{const{data:t,error:n}=await f.from("free_resources").select("*").order("created_at",{ascending:!1});if(n)throw n;w=t||[],b()}catch(t){console.error("Error fetching resources:",t.message),e.innerHTML='<div style="padding: 40px; text-align: center; color: #991B1B; grid-column: 1/-1;">Failed to load resources. Please try again later.</div>'}}function b(){const e=document.getElementById("resourcesGrid");if(!e)return;const t=w.filter(n=>p==="all"?!0:n.type===p);if(t.length===0){e.innerHTML='<div style="padding: 60px; text-align: center; color: #6b7280; grid-column: 1/-1;"><p style="font-size: 1.1rem;">No resources found in this category.</p></div>';return}e.innerHTML=t.map(n=>C(n)).join("")}function C(e){const t={notes:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>',slides:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>',exam:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>',info:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'};return`
        <div class="resource-card">
            <div style="display: flex; gap: 16px; align-items: flex-start;">
                <div class="resource-icon-wrapper">
                    ${{notes:t.notes,slides:t.slides,exam:t.exam,info:t.info}[e.type]||t.notes}
                </div>
                <div style="flex: 1;">
                    <span class="resource-badge badge-${e.type||"notes"}">${e.type||"Resource"}</span>
                    <h3 style="font-size: 1.1rem; font-weight: 600; margin-top: 4px; color: #111827;">${e.title}</h3>
                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 2px;">${e.course||"General"}</p>
                </div>
            </div>
            <div class="resource-meta">
                <span>File: ${e.file_type||"PDF"}</span>
                <span>${new Date(e.created_at).toLocaleDateString()}</span>
            </div>
            <button class="download-btn" data-id="${e.id}" data-url="${e.file_url}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Download
            </button>
        </div>
    `}function U(){const e=document.querySelectorAll(".resource-tab");e.forEach(o=>{o.addEventListener("click",()=>{e.forEach(r=>r.classList.remove("active")),o.classList.add("active"),p=o.dataset.category,b()})});const t=document.getElementById("resourceSearch");t&&t.addEventListener("input",M(o=>{const r=o.target.value.toLowerCase(),c=document.getElementById("resourcesGrid"),s=w.filter(d=>{const v=d.title.toLowerCase().includes(r)||d.course.toLowerCase().includes(r),g=p==="all"||d.type===p;return v&&g});s.length===0?c.innerHTML='<div style="padding: 60px; text-align: center; color: #6b7280; grid-column: 1/-1;">No matching resources found.</div>':c.innerHTML=s.map(d=>C(d)).join("")},300));const n=document.getElementById("resourcesGrid");n&&n.addEventListener("click",async o=>{const r=o.target.closest(".download-btn");if(!r)return;const c=r.dataset.id,s=r.dataset.url;s?(window.open(s,"_blank"),await f.from("resource_downloads").insert([{resource_id:c,user_id:(await h()).id}])):alert("This resource file is currently unavailable.")});const i=document.querySelector(".logout-btn");i&&i.addEventListener("click",async()=>{confirm("Are you sure you want to logout?")&&(await _(),window.location.href="index.html")});const x=document.getElementById("uploadFAB"),a=document.getElementById("resourceModal"),E=document.getElementById("closeResourceModal"),y=document.getElementById("resourceForm"),l=document.getElementById("fileUploadArea"),m=document.getElementById("resourceFile"),u=document.getElementById("fileNameDisplay");x&&a&&x.addEventListener("click",()=>a.classList.add("active")),E&&a&&E.addEventListener("click",()=>a.classList.remove("active")),a&&a.addEventListener("click",o=>{o.target===a&&a.classList.remove("active")}),l&&m&&(l.addEventListener("click",()=>m.click()),m.addEventListener("change",o=>{const r=o.target.files[0];r&&(u.textContent=`Selected: ${r.name}`,u.style.color="#368CBF")}),l.addEventListener("dragover",o=>{o.preventDefault(),l.classList.add("dragover")}),l.addEventListener("dragleave",()=>{l.classList.remove("dragover")}),l.addEventListener("drop",o=>{o.preventDefault(),l.classList.remove("dragover");const r=o.dataTransfer.files[0];r&&r.type==="application/pdf"?(m.files=o.dataTransfer.files,u.textContent=`Selected: ${r.name}`,u.style.color="#368CBF"):alert("Please upload a PDF file.")})),y&&y.addEventListener("submit",async o=>{o.preventDefault();const r=document.getElementById("submitResourceBtn"),c=m.files[0];if(!c){alert("Please select a PDF file to upload.");return}r.disabled=!0,r.textContent="Uploading...";try{const s=await h();if(!s)throw new Error("You must be logged in to upload.");const d=c.name.split(".").pop(),v=`${Date.now()}_${Math.random().toString(36).substring(7)}.${d}`,g=`resources/${s.id}/${v}`,{data:T,error:L}=await f.storage.from("free-resources").upload(g,c);if(L)throw L;const{data:{publicUrl:k}}=f.storage.from("free-resources").getPublicUrl(g),D={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,course:document.getElementById("resourceCourse").value,year:parseInt(document.getElementById("resourceYear").value)||new Date().getFullYear(),description:document.getElementById("resourceDescription").value,file_url:k,file_type:"PDF",uploader_id:s.id},{error:B}=await f.from("free_resources").insert([D]);if(B)throw B;alert("Resource uploaded successfully!"),a.classList.remove("active"),y.reset(),u.textContent="Click to upload or drag and drop",u.style.color="",await I()}catch(s){console.error("Upload error:",s),alert(`Error: ${s.message}`)}finally{r.disabled=!1,r.textContent="Upload Resource"}})}function M(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}
