import{l as h,s as i,g as w}from"./auth-JaHXRiaM.js";/* empty css              */import"./admin-BcUQKC8m.js";document.addEventListener("DOMContentLoaded",async()=>{console.log("Account page specialized logic ready."),E()});function E(){const s=document.getElementById("sidebarLogout");s&&s.addEventListener("click",async a=>{a.preventDefault(),confirm("Are you sure you want to logout?")&&(await h(),window.location.href="index.html")});const l=document.getElementById("avatarInput");l&&l.addEventListener("change",async a=>{console.log("Avatar input changed");const t=a.target.files[0];if(!t){console.log("No file selected");return}if(alert("File selected: "+t.name+" ("+Math.round(t.size/1024)+"KB). Starting upload..."),t.size>2*1024*1024){alert("File size must be less than 2MB");return}try{const r=document.querySelector(".avatar-edit-overlay"),p=r.innerHTML;r.innerHTML='<span style="font-size: 10px;">‚è≥</span>';const{data:{user:c}}=await i.auth.getUser();if(!c)throw new Error("Not authenticated");const g=t.name.split(".").pop(),v=`${Date.now()}.${g}`,m=`${c.id}/${v}`,{error:y}=await i.storage.from("avatars").upload(m,t,{upsert:!0});if(y)throw y;const{data:{publicUrl:u}}=i.storage.from("avatars").getPublicUrl(m),{error:f}=await i.from("profiles").update({avatar_url:u}).eq("id",c.id);if(f)throw f;if(window.syncProfileUI){const C={...c,avatar_url:u};document.getElementById("profileAvatar").src=u,document.getElementById("topNavAvatar").src=u,alert("Profile picture updated!")}else window.location.reload();r.innerHTML=p}catch(r){console.error("Avatar upload failed:",r),alert("Failed to update profile picture: "+r.message),document.querySelector(".avatar-edit-overlay").innerHTML=`
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                `}});const o=document.getElementById("username"),e=document.getElementById("saveProfileBtn"),n=document.getElementById("usernameFeedback");let d="";o&&e&&n&&(o.removeAttribute("readonly"),o.style.cursor="text",o.style.backgroundColor="white",o.addEventListener("focus",()=>{d||(d=o.value)}),o.addEventListener("input",a=>{const t=a.target.value.trim(),r=/^[a-zA-Z0-9_]{3,20}$/.test(t);t===d?(e.style.opacity="0.5",e.style.pointerEvents="none",n.textContent="",o.style.borderColor="#d1d5db"):r?(e.style.opacity="1",e.style.pointerEvents="auto",n.textContent="Looks good! Click save to check availability.",n.style.color="green",o.style.borderColor="green"):(e.style.opacity="0.5",e.style.pointerEvents="none",n.textContent="Username must be 3-20 chars, alphanumeric or underscore.",n.style.color="red",o.style.borderColor="red")}),e.addEventListener("click",async()=>{const a=o.value.trim();e.textContent="Saving...",e.disabled=!0;try{const{data:{user:t}}=await i.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:r}=await i.from("profiles").update({username:a}).eq("id",t.id);if(r)throw r.code==="23505"?new Error("This username is already taken."):r;alert("Username updated successfully!"),d=a,e.textContent="Saved",setTimeout(()=>{e.textContent="Save Changes",e.style.opacity="0.5",e.style.pointerEvents="none"},2e3),window.syncProfileUI&&(document.getElementById("profileFullName").textContent=a,document.getElementById("userName").textContent=a)}catch(t){console.error("Update failed:",t),n.textContent=t.message,n.style.color="red",o.style.borderColor="red",e.textContent="Save Changes",e.disabled=!1}}))}document.addEventListener("DOMContentLoaded",async()=>{const s=await w();if(s){const l=document.getElementById("detailsRoleBadge"),o=document.getElementById("sellerStatusCard"),e=document.getElementById("becomeSellerBtn"),n=document.getElementById("sellerStatusText");l&&(l.textContent=s.role==="seller"?"Verified Seller":"Student / Buyer",l.className=s.role==="seller"?"badge success":"badge"),o&&(s.role==="seller"?(n.textContent="You are a verified seller. You have full access to the dashboard.",e.style.display="none"):(n.textContent="You are currently a buyer. Verify your student status to start selling items.",e.style.display="block"))}});
//# sourceMappingURL=account-E5Zl9Wzq.js.map
