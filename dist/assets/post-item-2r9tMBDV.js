import{i as u,g as d,s as l,b as g}from"./auth-DlafXHy2.js";/* empty css              */let i=[];document.addEventListener("DOMContentLoaded",async()=>{if(!await u()){window.location.href="index.html";return}p(),f()});async function p(){const n=await d();if(n){const r=document.getElementById("topNavName"),a=document.getElementById("topNavAvatar"),t=n.username||n.name||"User";r&&(r.textContent=t),a&&(a.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=368CBF&color=fff`)}}function f(){const n=document.getElementById("imageInput");document.getElementById("imageGrid");const r=document.getElementById("postItemForm"),a=document.querySelector(".logout-btn");n.addEventListener("change",t=>{const o=Array.from(t.target.files);if(i.length+o.length>5){alert("You can only upload up to 5 images.");return}o.forEach(e=>{i.push(e),v(e)}),n.value=""}),r.addEventListener("submit",async t=>{t.preventDefault();const o=document.getElementById("submitBtn");o.disabled=!0,o.textContent="Posting...";try{const e=await d();if(!e)throw new Error("Authentication required");const s=await y(e.id),c={seller_id:e.id,seller_public_id:e.publicUserId||null,title:document.getElementById("title").value,description:document.getElementById("description").value,price:parseFloat(document.getElementById("price").value),category:document.getElementById("category").value,image_url:s[0]||null,images:s,status:"active"},{data:E,error:m}=await l.from("market_listings").insert([c]).select();if(m)throw m;alert("Item posted successfully!"),window.location.href="listings.html"}catch(e){console.error("Post error:",e),alert(`Error: ${e.message}`),o.disabled=!1,o.textContent="List Item Now"}}),a&&a.addEventListener("click",async()=>{confirm("Are you sure you want to logout?")&&(await g(),window.location.href="index.html")})}function v(n){const r=document.getElementById("imageGrid"),a=document.getElementById("uploadBtn"),t=document.createElement("div");t.className="image-preview-box";const o=document.createElement("img");o.src=URL.createObjectURL(n);const e=document.createElement("button");e.className="remove-img",e.textContent="Ã—",e.onclick=()=>{i=i.filter(s=>s!==n),t.remove()},t.appendChild(o),t.appendChild(e),r.insertBefore(t,a)}async function y(n){const r=[];for(const a of i){const t=a.name.split(".").pop(),o=`${Date.now()}_${Math.random().toString(36).substring(7)}.${t}`,e=`${n}/${o}`,{error:s}=await l.storage.from("listing-images").upload(e,a);if(s)throw s;const{data:{publicUrl:c}}=l.storage.from("listing-images").getPublicUrl(e);r.push(c)}return r}
