import{i as D,s as u,g as L}from"./auth-B4SlU3WG.js";/* empty css              */import"./admin-8vNtIyrQ.js";let h=[],p="all";document.addEventListener("DOMContentLoaded",async()=>{if(!await D()){window.location.href="index.html";return}await B(),$(),u.auth.onAuthStateChange(r=>{r==="SIGNED_OUT"&&(window.location.href="index.html")})});async function B(){const e=document.getElementById("resourcesGrid");if(e)try{const{data:r,error:n}=await u.from("free_resources").select("*").order("created_at",{ascending:!1});if(n)throw n;h=r||[],I()}catch(r){console.error("Error fetching resources:",r.message),e.innerHTML='<div style="padding: 40px; text-align: center; color: #991B1B; grid-column: 1/-1;">Failed to load resources. Please try again later.</div>'}}function I(){const e=document.getElementById("resourcesGrid");if(!e)return;const r=h.filter(n=>p==="all"?!0:n.type===p);if(r.length===0){e.innerHTML='<div style="padding: 60px; text-align: center; color: #6b7280; grid-column: 1/-1;"><p style="font-size: 1.1rem;">No resources found in this category.</p></div>';return}e.innerHTML=r.map(n=>b(n)).join("")}function b(e){const r={notes:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>',slides:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>',exam:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>',info:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'};return`
        <div class="resource-card">
            <div style="display: flex; gap: 16px; align-items: flex-start;">
                <div class="resource-icon-wrapper">
                    ${{notes:r.notes,slides:r.slides,exam:r.exam,info:r.info}[e.type]||r.notes}
                </div>
                <div style="flex: 1;">
                    <span class="resource-badge badge-${e.type||"notes"}">${e.type||"Resource"}</span>
                    <h3 style="font-size: 1.1rem; font-weight: 600; margin-top: 4px; color: #111827;">${e.title}</h3>
                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 2px;">${e.course||"General"}</p>
                </div>
            </div>
            <div class="resource-meta">
                <span>File: ${e.file_type||"PDF"}</span>
                <span>${new Date(e.created_at).toLocaleDateString()}</span>
            </div>
            <button class="download-btn" data-id="${e.id}" data-url="${e.file_url}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                Download
            </button>
        </div>
    `}function $(){const e=document.querySelectorAll(".resource-tab");e.forEach(o=>{o.addEventListener("click",()=>{e.forEach(t=>t.classList.remove("active")),o.classList.add("active"),p=o.dataset.category,I()})});const r=document.getElementById("resourceSearch");r&&r.addEventListener("input",_(o=>{const t=o.target.value.toLowerCase(),l=document.getElementById("resourcesGrid"),s=h.filter(c=>{const v=c.title.toLowerCase().includes(t)||c.course.toLowerCase().includes(t),g=p==="all"||c.type===p;return v&&g});s.length===0?l.innerHTML='<div style="padding: 60px; text-align: center; color: #6b7280; grid-column: 1/-1;">No matching resources found.</div>':l.innerHTML=s.map(c=>b(c)).join("")},300));const n=document.getElementById("resourcesGrid");n&&n.addEventListener("click",async o=>{const t=o.target.closest(".download-btn");if(!t)return;const l=t.dataset.id,s=t.dataset.url;s?(window.open(s,"_blank"),await u.from("resource_downloads").insert([{resource_id:l,user_id:(await L()).id}])):alert("This resource file is currently unavailable.")});const m=document.getElementById("uploadFAB"),i=document.getElementById("resourceModal"),x=document.getElementById("closeResourceModal"),y=document.getElementById("resourceForm"),a=document.getElementById("fileUploadArea"),f=document.getElementById("resourceFile"),d=document.getElementById("fileNameDisplay");m&&i&&m.addEventListener("click",()=>i.classList.add("active")),x&&i&&x.addEventListener("click",()=>i.classList.remove("active")),i&&i.addEventListener("click",o=>{o.target===i&&i.classList.remove("active")}),a&&f&&(a.addEventListener("click",()=>f.click()),f.addEventListener("change",o=>{const t=o.target.files[0];t&&(d.textContent=`Selected: ${t.name}`,d.style.color="#368CBF")}),a.addEventListener("dragover",o=>{o.preventDefault(),a.classList.add("dragover")}),a.addEventListener("dragleave",()=>{a.classList.remove("dragover")}),a.addEventListener("drop",o=>{o.preventDefault(),a.classList.remove("dragover");const t=o.dataTransfer.files[0];t&&t.type==="application/pdf"?(f.files=o.dataTransfer.files,d.textContent=`Selected: ${t.name}`,d.style.color="#368CBF"):alert("Please upload a PDF file.")})),y&&y.addEventListener("submit",async o=>{o.preventDefault();const t=document.getElementById("submitResourceBtn"),l=f.files[0];if(!l){alert("Please select a PDF file to upload.");return}t.disabled=!0,t.textContent="Uploading...";try{const s=await L();if(!s)throw new Error("You must be logged in to upload.");const c=l.name.split(".").pop(),v=`${Date.now()}_${Math.random().toString(36).substring(7)}.${c}`,g=`resources/${s.id}/${v}`,{data:F,error:w}=await u.storage.from("free-resources").upload(g,l);if(w)throw w;const{data:{publicUrl:C}}=u.storage.from("free-resources").getPublicUrl(g),k={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,course:document.getElementById("resourceCourse").value,year:parseInt(document.getElementById("resourceYear").value)||new Date().getFullYear(),description:document.getElementById("resourceDescription").value,file_url:C,file_type:"PDF",uploader_id:s.id},{error:E}=await u.from("free_resources").insert([k]);if(E)throw E;alert("Resource uploaded successfully!"),i.classList.remove("active"),y.reset(),d.textContent="Click to upload or drag and drop",d.style.color="",await B()}catch(s){console.error("Upload error:",s),alert(`Error: ${s.message}`)}finally{t.disabled=!1,t.textContent="Upload Resource"}})}function _(e,r){let n;return function(...m){clearTimeout(n),n=setTimeout(()=>e.apply(this,m),r)}}
