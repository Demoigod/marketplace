import{i as c,g as m,s as n,a as _,l as H,r as q,b as x}from"./navbar-DAxEynKi.js";/* empty css               */async function D(e){var f;if(e.preventDefault(),!await c()){alert("Please log in to post an item."),document.dispatchEvent(new CustomEvent("open-auth-modal"));return}const t=await m();if(!t)return;const s=e.target,r=s.querySelector("#itemTitle").value,o=parseFloat(s.querySelector("#itemPrice").value),a=s.querySelector("#itemDescription").value,C=s.querySelector("#itemCategory").value,S=["https://placeholder.com/600x400"];if(!r||isNaN(o)||!a){alert("Please fill in all required fields.");return}try{const{data:l,error:p}=await n.from("items").insert([{user_id:t.id,title:r,description:a,price:o,images:S,category:C,condition:((f=s.querySelector("#itemCondition"))==null?void 0:f.value)||"good"}]).select().single();if(p)throw p;console.log("Item posted successfully:",l),alert("Your item is now live!"),s.reset();const h=document.getElementById("uploadModal");h&&h.classList.remove("active"),document.dispatchEvent(new CustomEvent("item-posted"))}catch(l){console.error("Error posting item:",l.message),alert("Error: "+l.message)}}async function T(){try{const{data:e,error:t}=await n.from("items").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){return console.error("Error fetching items:",e),[]}}function v(e,t=!1){const s=new Date(e.created_at).toLocaleDateString(),r=e.images&&e.images.length>0?e.images[0]:"https://via.placeholder.com/300x200",o=t?"":"disabled",a=t?"":'title="Please login to use this feature"';return`
        <div class="marketplace-item" data-id="${e.id}" data-user-id="${e.user_id}">
            <div class="item-image" style="background-image: url('${r}'); background-size: cover; background-position: center;"></div>
            <div class="item-content">
                <div class="item-header">
                    <h3 class="item-title">${y(e.title)}</h3>
                    <span class="item-price">$${parseFloat(e.price).toFixed(2)}</span>
                </div>
                <p class="item-date">Posted on ${s}</p>
                <p class="item-description">${y(e.description)}</p>
                
                
                <div class="item-actions-grid">
                    <button class="btn-buy" ${o} ${a} data-action="buy" data-id="${e.id}">Buy</button>
                    <button class="btn-contact" ${o} ${a} data-action="contact" data-seller-id="${e.user_id}">Contact Seller</button>
                    <button class="btn-view" data-action="view" data-id="${e.id}">View</button>
                    <button class="btn-save" data-action="save" data-item-id="${e.id}">Save</button>
                </div>
            </div>
        </div>
    `}function y(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async function A(e){if(!await c()){alert("Please log in to save items."),document.dispatchEvent(new CustomEvent("open-auth-modal"));return}const t=await m();if(t)try{const{data:s,error:r}=await n.from("saved_items").select("id").eq("user_id",t.id).eq("item_id",e).maybeSingle();if(r)throw r;if(s){const{error:o}=await n.from("saved_items").delete().eq("id",s.id);if(o)throw o;return{saved:!1,message:"Item removed from bookmarks"}}else{const{error:o}=await n.from("saved_items").insert([{user_id:t.id,item_id:e}]);if(o)throw o;return{saved:!0,message:"Item saved successfully!"}}}catch(s){throw console.error("Save error:",s),s}}function F(){document.addEventListener("click",async e=>{if(e.target.classList.contains("btn-save")){const t=e.target.dataset.itemId,s=e.target;s.disabled=!0;try{const r=await A(t);s.classList.toggle("active",r.saved),s.textContent=r.saved?"Saved":"Save",console.log(r.message)}catch{alert("Failed to save item.")}finally{s.disabled=!1}}})}let g="all",L=[];document.getElementById("uploadModal");document.getElementById("resourceModal");document.getElementById("authModal");document.getElementById("postItemBtn");document.getElementById("uploadResourceBtn");const w=document.getElementById("uploadForm"),E=document.getElementById("resourceForm"),b=document.getElementById("loginForm"),I=document.getElementById("registerForm"),k=document.getElementById("searchInput"),i=document.getElementById("marketplaceGrid"),d=document.getElementById("resourcesGrid");document.getElementById("loginBtn");const u=document.getElementById("dashboardLink");document.addEventListener("DOMContentLoaded",async()=>{await _(),await P(),B(),M(),F(),new URLSearchParams(window.location.search).get("action")==="post"&&setTimeout(()=>{document.dispatchEvent(new CustomEvent("open-post-modal"))},800),j()});async function P(){const e=await c(),t=await m();e&&t?u&&(u.style.display="block"):u&&(u.style.display="none")}async function B(){const e=await c(),t=await T();i&&(t&&t.length>0?i.innerHTML=t.map(s=>v(s,e)).join(""):i.innerHTML='<p class="empty-state">No items found. Be the first to post!</p>')}document.addEventListener("item-posted",B);async function M(){if(d)try{const{data:e,error:t}=await n.from("free_resources").select("*").order("created_at",{ascending:!1});if(t)throw t;L=e||[],$()}catch(e){console.error("Error fetching resources:",e.message),d.innerHTML='<p class="error-state">Failed to load resources.</p>'}}function $(){if(!d)return;const e=L.filter(t=>g==="all"?!0:t.type===g);if(e.length===0){d.innerHTML='<p class="empty-state">No resources found.</p>';return}d.innerHTML=e.map(t=>R(t)).join("")}function R(e){const t={exam:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/></svg>',textbook:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor" stroke-width="2"/></svg>',notes:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke="currentColor" stroke-width="2"/></svg>'};return`
        <div class="resource-card" data-id="${e.id}">
            <div class="resource-header">
                <div class="resource-icon">
                    ${t[e.type]||t.exam}
                </div>
                <div class="resource-info">
                    <span class="resource-type">${e.type}</span>
                    <h3 class="resource-title">${e.title}</h3>
                    <p class="resource-course">${e.course}</p>
                </div>
            </div>
            <div class="resource-meta">
                <span class="resource-year">${e.year}</span>
                <button class="download-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 11V3M8 11L5 8M8 11L11 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 13H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Download
                </button>
            </div>
        </div>
    `}function j(){k&&k.addEventListener("input",G(z,300)),document.querySelectorAll(".category-chip").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".category-chip").forEach(s=>s.classList.remove("active")),e.classList.add("active");const t=e.dataset.category;V(t)})}),document.querySelectorAll(".resource-chip").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".resource-chip").forEach(t=>t.classList.remove("active")),e.classList.add("active"),g=e.dataset.type,$()})}),w&&w.addEventListener("submit",D),b&&b.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("loginEmail").value,s=document.getElementById("loginPassword").value,r=await H(t,s);r.success?(alert("Login successful!"),window.location.reload()):alert(r.message)}),I&&I.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("registerName").value,s=document.getElementById("registerEmail").value,r=document.getElementById("registerPassword").value,o=document.getElementById("registerRole").value,a=await q(s,r,t,o);a.success?(alert(a.message),window.location.reload()):alert(a.message)}),E&&E.addEventListener("submit",N),i&&i.addEventListener("click",e=>{const t=e.target.closest("button");if(!t)return;const s=t.dataset.action,r=t.dataset.id;if(s==="buy")window.location.href=`payment.html?item_id=${r}`;else if(s==="contact"){const o=t.dataset.sellerId;window.location.href=`messages.html?partner_id=${o}`}else s==="view"&&(window.location.href=`item.html?id=${r}`)}),d&&d.addEventListener("click",e=>{const t=e.target.closest(".download-btn");if(t){const s=t.closest(".resource-card");s&&U(s.dataset.id)}})}async function N(e){if(e.preventDefault(),!await c()){alert("Please login to upload resources.");return}const t=await m(),s={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,course:document.getElementById("resourceCourse").value,year:parseInt(document.getElementById("resourceYear").value)||new Date().getFullYear(),description:document.getElementById("resourceDescription").value,uploader_id:t.id},{error:r}=await n.from("free_resources").insert([s]);r?alert("Error uploading resource: "+r.message):(alert("Resource uploaded!"),document.getElementById("resourceModal").classList.remove("active"),M())}async function U(e){if(!await c()){document.dispatchEvent(new CustomEvent("open-auth-modal"));return}await x({id:e}),alert("Download started!")}function G(e,t){let s;return function(...r){clearTimeout(s),s=setTimeout(()=>e.apply(this,r),t)}}async function z(e){const t=e.target.value.toLowerCase(),{data:s}=await n.from("items").select("*").or(`title.ilike.%${t}%,description.ilike.%${t}%`).eq("status","active"),r=await c();i&&(i.innerHTML=(s||[]).map(o=>v(o,r)).join(""))}async function V(e){const t=await c(),{data:s}=await n.from("items").select("*").order("created_at",{ascending:!1}),r=e==="all"?s:s.filter(o=>o.category===e);i&&(i.innerHTML=(r||[]).map(o=>v(o,t)).join(""))}
