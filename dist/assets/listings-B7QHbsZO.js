import{i as d,s as o}from"./auth-B4SlU3WG.js";/* empty css              */import"./admin-8vNtIyrQ.js";import{i as m,f as u,c as l}from"./save-item-Bcle7H9l.js";document.addEventListener("DOMContentLoaded",async()=>{if(!await d()){window.location.href="index.html";return}f(),g(),m(),o.auth.onAuthStateChange(e=>{e==="SIGNED_OUT"&&(window.location.href="index.html")})});async function f(){const n=document.getElementById("marketplaceGrid");if(n)try{const e=await u();console.log(`Loading ${(e==null?void 0:e.length)||0} items into grid...`);const i=!0;e&&e.length>0?n.innerHTML=e.map(t=>l(t,i)).join(""):n.innerHTML='<div class="empty-state" style="padding: 60px; text-align: center; grid-column: 1/-1;"><p style="color: #6B7280; font-size: 1.1rem;">No items found in the marketplace.</p></div>'}catch(e){console.error("Error loading marketplace:",e.message),n.innerHTML='<p class="error-state">Failed to load listings.</p>'}}function g(){const n=document.getElementById("listingsSearch");n&&n.addEventListener("input",p(async i=>{const t=i.target.value.toLowerCase(),s=document.getElementById("marketplaceGrid"),{data:r,error:a}=await o.from("market_listings").select(`
                    *,
                    profiles (
                        username,
                        full_name
                    )
                `).or(`title.ilike.%${t}%,description.ilike.%${t}%`).eq("status","active");a&&console.error("Search error:",a),s&&(s.innerHTML=(r||[]).map(c=>l(c,!0)).join(""))},300));const e=document.getElementById("marketplaceGrid");e&&e.addEventListener("click",async i=>{const t=i.target.closest("button");if(t){if(t.dataset.action==="view"){const s=t.dataset.id;window.location.href=`item.html?id=${s}`;return}if(t.classList.contains("contact-seller-btn")){const s=t.dataset.sellerId,r=t.dataset.listingId;window.location.href=`messages.html?seller_id=${s}&listing_id=${r}`;return}}})}function p(n,e){let i;return function(...t){clearTimeout(i),i=setTimeout(()=>n.apply(this,t),e)}}
