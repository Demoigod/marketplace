{"version":3,"file":"admin-BcUQKC8m.js","sources":["../../admin.js"],"sourcesContent":["import { supabase } from './supabase-config.js';\r\nimport { getCurrentUser, logoutUser } from './auth.js';\r\n\r\n\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    updateDate();\r\n    await initDashboard();\r\n    setupSidebar();\r\n});\r\n\r\nfunction updateDate() {\r\n    const dateEl = document.getElementById('currentDate');\r\n    if (dateEl) {\r\n        const now = new Date();\r\n        const options = { month: 'long', day: 'numeric', year: 'numeric' };\r\n        dateEl.textContent = `Today is ${now.toLocaleDateString('en-US', options)}`;\r\n    }\r\n}\r\n\r\nasync function initDashboard() {\r\n    const user = await getCurrentUser();\r\n    if (!user) return;\r\n\r\n    // 1. Sync all profile UI elements (Header + Page content)\r\n    syncProfileUI(user);\r\n\r\n    // 2. Load Metrics (Only if elements exist)\r\n\r\n    // 2. Load Metrics (Only if elements exist)\r\n    if (document.getElementById('countListings')) {\r\n        loadCounts(user.id);\r\n    }\r\n\r\n    // 3. Load Activity Feeds\r\n    if (document.getElementById('activityFeed1') || document.getElementById('notificationFeed')) {\r\n        loadActivityFeeds();\r\n    }\r\n\r\n    // 5. Load User Specific Listings\r\n    if (document.getElementById('myListingsFeed')) {\r\n        loadMyListings(user.id);\r\n        setupRealtimeListings(user.id);\r\n    }\r\n\r\n    // 6. Global Unread Messages Notifications\r\n    loadUnreadMessages(user.id);\r\n    subscribeToNewMessages(user.id);\r\n}\r\n\r\n/**\r\n * Fetches and displays listings belonging only to the authenticated user.\r\n */\r\nasync function loadMyListings(userId) {\r\n    const listEl = document.getElementById('myListingsFeed');\r\n    const badgeEl = document.getElementById('myListingsCountBadge');\r\n    if (!listEl) return;\r\n\r\n    try {\r\n        const { data: listings, error } = await supabase\r\n            .from('market_listings')\r\n            .select('title, price, status, created_at')\r\n            .eq('seller_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        if (badgeEl) badgeEl.textContent = listings.length;\r\n\r\n        // Update the metric card count too if it exists\r\n        const mainCountEl = document.getElementById('countListings');\r\n        if (mainCountEl) mainCountEl.textContent = listings.length;\r\n\r\n        if (listings.length === 0) {\r\n            listEl.innerHTML = '<div class=\"p-4 text-center text-gray-500\">You haven\\'t posted anything yet.</div>';\r\n            return;\r\n        }\r\n\r\n        listEl.innerHTML = listings.map(item => `\r\n            <div class=\"activity-item\">\r\n                <div class=\"logo-box\" style=\"background: #F8F9FA; color: var(--primary-color); width: 32px; height: 32px;\">\r\n                    <span style=\"font-size: 0.8rem; font-weight: 800;\">ðŸ›’</span>\r\n                </div>\r\n                <div class=\"act-body\">\r\n                    <span class=\"act-user\">${item.title}</span>\r\n                    <span class=\"act-desc\">R ${item.price} â€¢ <span class=\"status-tag ${item.status}\">${item.status.toUpperCase()}</span></span>\r\n                </div>\r\n                <span class=\"act-time\">${new Date(item.created_at).toLocaleDateString()}</span>\r\n            </div>\r\n        `).join('');\r\n\r\n    } catch (err) {\r\n        console.error('Error loading my listings:', err);\r\n        listEl.innerHTML = '<div class=\"p-4 text-red-500\">Could not load your listings.</div>';\r\n    }\r\n}\r\n\r\n/**\r\n * Listens for real-time changes to the market_listings table.\r\n */\r\nfunction setupRealtimeListings(userId) {\r\n    supabase\r\n        .channel('my-listings-changes')\r\n        .on('postgres_changes', {\r\n            event: '*',\r\n            schema: 'public',\r\n            table: 'market_listings',\r\n            filter: `seller_id=eq.${userId}`\r\n        }, (payload) => {\r\n            console.log('Real-time listing change detected:', payload.eventType);\r\n            loadMyListings(userId);\r\n        })\r\n        .subscribe();\r\n}\r\n\r\nasync function loadCounts(userId) {\r\n    try {\r\n        // Real listing count\r\n        const { count: listingCount } = await supabase\r\n            .from('market_listings')\r\n            .select('*', { count: 'exact', head: true })\r\n            .eq('seller_id', userId);\r\n\r\n        document.getElementById('countListings').textContent = listingCount || 0;\r\n\r\n        // Sample data for others (to be integrated with real tables later)\r\n        document.getElementById('countMessages').textContent = '12';\r\n        document.getElementById('unreadBadge').textContent = '6';\r\n        document.getElementById('countResources').textContent = '6';\r\n        document.getElementById('countSales').textContent = '3';\r\n    } catch (e) {\r\n        console.error('Error loading metrics:', e);\r\n    }\r\n}\r\n\r\nfunction loadActivityFeeds() {\r\n    const feed1 = document.getElementById('activityFeed1');\r\n    const feed2 = document.getElementById('activityFeed2');\r\n    const notifFeed = document.getElementById('notificationFeed');\r\n\r\n    const activityData = [\r\n        { name: 'John Doe', action: 'Bought item from seller', time: '30 mins ago' },\r\n        { name: 'Jane Smith', action: 'Listed a new textbook', time: '1 hour ago' },\r\n        { name: 'Alex Brown', action: 'Commented on your post', time: '2 hours ago' }\r\n    ];\r\n\r\n    const notifData = [\r\n        { name: 'John Doe', desc: 'sent you a message', time: '10 mins ago' },\r\n        { name: 'System', desc: 'Your document was approved', time: '1 hour ago' },\r\n        { name: 'Market', desc: 'New comment on your listing', time: '2 hours ago' }\r\n    ];\r\n\r\n    if (feed1) feed1.innerHTML = activityData.map(item => renderActivityItem(item)).join('');\r\n    if (feed2) feed2.innerHTML = activityData.map(item => renderActivityItem(item)).join('');\r\n    if (notifFeed) notifFeed.innerHTML = notifData.map(item => renderNotifItem(item)).join('');\r\n}\r\n\r\nfunction renderActivityItem(item) {\r\n    return `\r\n        <div class=\"activity-item\">\r\n            <img src=\"https://ui-avatars.com/api/?name=${encodeURIComponent(item.name)}&background=random\" class=\"act-avatar\">\r\n            <div class=\"act-body\">\r\n                <span class=\"act-user\">${item.name}</span>\r\n                <span class=\"act-desc\">${item.action}</span>\r\n            </div>\r\n            <span class=\"act-time\">${item.time}</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction renderNotifItem(item) {\r\n    return `\r\n        <div class=\"activity-item\">\r\n            <img src=\"https://ui-avatars.com/api/?name=${encodeURIComponent(item.name)}&background=F1F3F5&color=368CBF\" class=\"act-avatar\" style=\"border-radius: 8px;\">\r\n            <div class=\"act-body\">\r\n                <span class=\"act-user\">${item.name} ${item.desc}</span>\r\n                <span class=\"act-time\">${item.time}</span>\r\n            </div>\r\n            <span style=\"color: #ADB5BD; font-size: 1.2rem;\">...</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nfunction loadOnlineUsers() {\r\n    const grid = document.getElementById('onlineGrid');\r\n    const users = ['John', 'Emily', 'Alex', 'Sarah', 'Mike', 'Sophia', 'Linda'];\r\n\r\n    if (grid) {\r\n        grid.innerHTML = users.map(u => `\r\n            <div class=\"online-u\">\r\n                <img src=\"https://ui-avatars.com/api/?name=${u}&background=random\">\r\n                <span>${u}</span>\r\n            </div>\r\n        `).join('');\r\n    }\r\n}\r\n\r\n/**\r\n * Centralized Sidebar & Header Navigation Logic\r\n * Handles transitions, auth guards, and automatic active states.\r\n */\r\nfunction setupSidebar() {\r\n    const sidebar = document.querySelector('.sidebar');\r\n    if (!sidebar) return;\r\n\r\n    // 1. Set Automatic Active State based on current URL\r\n    const currentPath = window.location.pathname.split('/').pop() || 'admin.html';\r\n    document.querySelectorAll('.nav-link').forEach(link => {\r\n        const href = link.getAttribute('href');\r\n        if (href === currentPath) {\r\n            link.classList.add('active');\r\n        } else {\r\n            link.classList.remove('active');\r\n        }\r\n    });\r\n\r\n    // 2. Sidebar Link Handling (Event Delegation)\r\n    sidebar.addEventListener('click', async (e) => {\r\n        const link = e.target.closest('.nav-link');\r\n        if (!link) return;\r\n\r\n        if (link.id === 'sidebarLogout') {\r\n            e.preventDefault();\r\n            handleLogout();\r\n            return;\r\n        }\r\n\r\n        const href = link.getAttribute('href');\r\n        if (href === '#' || !href) {\r\n            e.preventDefault();\r\n            return;\r\n        }\r\n\r\n        // Auth Guard Check\r\n        const { data: { session } } = await supabase.auth.getSession();\r\n        if (!session && href !== 'index.html') {\r\n            e.preventDefault();\r\n            window.location.href = 'index.html';\r\n            return;\r\n        }\r\n    });\r\n\r\n    // 3. Global Header Triggers (Profile, Search, etc.)\r\n    const profileToggle = document.getElementById('profileToggle');\r\n    if (profileToggle) {\r\n        profileToggle.addEventListener('click', () => {\r\n            window.location.href = 'account.html';\r\n        });\r\n    }\r\n\r\n    // Initialize Header Profile Info (if elements exist)\r\n    syncProfileUI();\r\n}\r\n\r\n/**\r\n * CRITICAL FIX: Unified UI Synching for all Profile data\r\n * Handles Header, Sidebar, and Account page middle section.\r\n */\r\nasync function syncProfileUI(existingUser = null) {\r\n    console.log('--- SYNC ATTEMPT START ---');\r\n    try {\r\n        const user = existingUser || await getCurrentUser();\r\n        if (!user) {\r\n            console.warn('Sync aborted: User object not found.');\r\n            return;\r\n        }\r\n\r\n        const applyUpdates = () => {\r\n            // 1. Resolve Data with string safety\r\n            const first = String(user.first_name || user.user_metadata?.first_name || '');\r\n            const last = String(user.last_name || user.user_metadata?.last_name || '');\r\n            const uname = String(user.username || user.user_metadata?.username || 'User');\r\n            const email = String(user.email || '');\r\n            const phone = String(user.phone || user.phone_number || '');\r\n            const displayId = String(user.immutable_user_code || (user.id ? user.id.slice(0, 6).toUpperCase() : '000000'));\r\n\r\n            // Determine full display name\r\n            let fullDisplay = uname;\r\n            if (first) fullDisplay = `${first} ${last}`.trim();\r\n            if (fullDisplay === 'User' && first) fullDisplay = `${first} ${last}`.trim();\r\n\r\n            const avatarSrc = user.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(fullDisplay)}&background=368CBF&color=fff`;\r\n\r\n            // 2. Element Registry (ID -> Value/Action)\r\n            const registry = [\r\n                { id: 'userName', attr: 'textContent', val: fullDisplay },\r\n                { id: 'welcomeTitle', attr: 'textContent', val: `Welcome, ${first || uname} ðŸ‘‹` },\r\n                { id: 'userId', attr: 'textContent', val: `ID: ${displayId}` },\r\n                { id: 'profileFullName', attr: 'textContent', val: fullDisplay },\r\n                { id: 'profileRole', attr: 'textContent', val: (user.role || 'Member').charAt(0).toUpperCase() + (user.role || 'Member').slice(1) },\r\n                { id: 'publicUserIdDisplay', attr: 'textContent', val: `ID: #${displayId}` },\r\n                { id: 'topNavAvatar', attr: 'src', val: avatarSrc },\r\n                { id: 'userAvatar', attr: 'src', val: avatarSrc },\r\n                { id: 'profileAvatar', attr: 'src', val: avatarSrc },\r\n                { id: 'firstName', attr: 'value', val: first },\r\n                { id: 'lastName', attr: 'value', val: last },\r\n                { id: 'username', attr: 'value', val: uname },\r\n                { id: 'email', attr: 'value', val: email },\r\n                { id: 'phone', attr: 'value', val: phone }\r\n            ];\r\n\r\n            registry.forEach(item => {\r\n                const el = document.getElementById(item.id);\r\n                if (el) {\r\n                    if (item.attr === 'value') {\r\n                        el.value = item.val;\r\n                        el.placeholder = item.val || 'Not provided';\r\n                    } else {\r\n                        el[item.attr] = item.val;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // CRITICAL FIX: Inject Avatar Upload UI if User has cached HTML\r\n            const avatarImg = document.getElementById('profileAvatar');\r\n            if (avatarImg && !avatarImg.closest('.avatar-upload-wrapper')) {\r\n                console.log('Detected cached HTML: Injecting Avatar Upload UI...');\r\n                const wrapper = document.createElement('div');\r\n                wrapper.className = 'avatar-upload-wrapper';\r\n                wrapper.style.position = 'relative';\r\n                wrapper.style.display = 'inline-block';\r\n\r\n                // Clone image to preserve it\r\n                const newImg = avatarImg.cloneNode(true);\r\n                wrapper.appendChild(newImg);\r\n\r\n                // Add Overlay\r\n                const label = document.createElement('label');\r\n                label.className = 'avatar-edit-overlay';\r\n                label.htmlFor = 'avatarInput';\r\n                label.innerHTML = `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\"><path d=\"M12 20h9\"></path><path d=\"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z\"></path></svg>`;\r\n                wrapper.appendChild(label);\r\n\r\n                // Add Input\r\n                const input = document.createElement('input');\r\n                input.type = 'file';\r\n                input.id = 'avatarInput';\r\n                input.accept = 'image/*';\r\n                input.style.display = 'none';\r\n                wrapper.appendChild(input);\r\n\r\n                // Perform Replacement\r\n                avatarImg.parentNode.insertBefore(wrapper, avatarImg);\r\n                avatarImg.remove(); // Remove old orphan image\r\n\r\n                // Add CSS if missing\r\n                if (!document.getElementById('avatar-styles')) {\r\n                    const style = document.createElement('style');\r\n                    style.id = 'avatar-styles';\r\n                    style.textContent = `\r\n                        .avatar-edit-overlay { position: absolute; bottom: 0; right: 0; background: #368CBF; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white; transition: transform 0.2s; }\r\n                        .avatar-edit-overlay:hover { transform: scale(1.1); }\r\n                    `;\r\n                    document.head.appendChild(style);\r\n                }\r\n            }\r\n\r\n            // CRITICAL FIX: Inject Username Edit UI if User has cached HTML\r\n            const usernameInput = document.getElementById('username');\r\n            if (usernameInput && usernameInput.hasAttribute('readonly') && document.querySelector('.profile-form')) {\r\n                console.log('Detected cached HTML: Injecting Username Edit UI...');\r\n\r\n                // 1. Transform Input\r\n                usernameInput.removeAttribute('readonly');\r\n                usernameInput.placeholder = 'Choose a unique username';\r\n                usernameInput.autocomplete = 'off';\r\n                usernameInput.classList.add('editable-username'); // Marker\r\n\r\n                // 2. Add Feedback Area\r\n                if (!document.getElementById('usernameFeedback')) {\r\n                    const feedback = document.createElement('small');\r\n                    feedback.id = 'usernameFeedback';\r\n                    feedback.style.display = 'block';\r\n                    feedback.style.marginTop = '4px';\r\n                    feedback.style.fontSize = '0.75rem';\r\n                    feedback.style.minHeight = '1.2em';\r\n                    usernameInput.parentNode.appendChild(feedback);\r\n                }\r\n\r\n                // 3. Add Save Button\r\n                if (!document.getElementById('saveProfileBtn')) {\r\n                    const btnDiv = document.createElement('div');\r\n                    btnDiv.className = 'form-actions';\r\n                    btnDiv.style.marginTop = '0.5rem';\r\n                    btnDiv.style.textAlign = 'right';\r\n                    btnDiv.innerHTML = `<button id=\"saveProfileBtn\" class=\"btn-primary\" style=\"padding: 0.75rem 1.5rem; border-radius: 6px; border: none; background: #368CBF; color: white; font-weight: 600; cursor: pointer; opacity: 0.5; pointer-events: none; transition: opacity 0.2s;\">Save Changes</button>`;\r\n                    usernameInput.parentNode.parentNode.appendChild(btnDiv); // append to form-grid or group parent? \r\n                    // The structure is form-grid -> form-group -> input. \r\n                    // We want the button after the form-group.\r\n                    usernameInput.parentNode.after(btnDiv);\r\n                }\r\n\r\n                // 4. Attach Logic (Self-contained to bypass stale account.js)\r\n                const saveBtn = document.getElementById('saveProfileBtn');\r\n                const feedback = document.getElementById('usernameFeedback');\r\n                let originalName = usernameInput.value;\r\n\r\n                usernameInput.addEventListener('focus', () => { if (!originalName) originalName = usernameInput.value; });\r\n                usernameInput.addEventListener('input', (e) => {\r\n                    const val = e.target.value.trim();\r\n                    const valid = /^[a-zA-Z0-9_]{3,20}$/.test(val);\r\n                    if (val === originalName) {\r\n                        saveBtn.style.opacity = '0.5'; saveBtn.style.pointerEvents = 'none'; feedback.textContent = ''; usernameInput.style.borderColor = '#d1d5db';\r\n                    } else if (!valid) {\r\n                        saveBtn.style.opacity = '0.5'; saveBtn.style.pointerEvents = 'none'; feedback.textContent = 'Invalid format (3-20 chars, alphanumeric/_)'; feedback.style.color = 'red'; usernameInput.style.borderColor = 'red';\r\n                    } else {\r\n                        saveBtn.style.opacity = '1'; saveBtn.style.pointerEvents = 'auto'; feedback.textContent = 'Looks good!'; feedback.style.color = 'green'; usernameInput.style.borderColor = 'green';\r\n                    }\r\n                });\r\n\r\n                saveBtn.addEventListener('click', async () => {\r\n                    const newName = usernameInput.value.trim();\r\n                    saveBtn.textContent = 'Saving...'; saveBtn.disabled = true;\r\n                    try {\r\n                        const { data: { user } } = await supabase.auth.getUser();\r\n                        if (!user) throw new Error('Not logged in');\r\n                        const { error } = await supabase.from('profiles').update({ username: newName }).eq('id', user.id);\r\n                        if (error) { if (error.code === '23505') throw new Error('Username taken'); else throw error; }\r\n                        alert('Username updated!');\r\n                        originalName = newName;\r\n                        saveBtn.textContent = 'Saved';\r\n                        setTimeout(() => { saveBtn.textContent = 'Save Changes'; saveBtn.style.opacity = '0.5'; saveBtn.style.pointerEvents = 'none'; }, 2000);\r\n                    } catch (err) {\r\n                        alert(err.message);\r\n                        saveBtn.textContent = 'Save Changes'; saveBtn.disabled = false;\r\n                    }\r\n                });\r\n            }\r\n\r\n            console.log('--- SYNC SUCCESSFUL ---');\r\n        };\r\n\r\n        // Run immediately\r\n        applyUpdates();\r\n\r\n        // Also run in 300ms to catch any late DOM transitions or browser autofill delays\r\n        setTimeout(applyUpdates, 300);\r\n\r\n    } catch (error) {\r\n        console.error('CRITICAL ERROR during Profile UI sync:', error);\r\n    }\r\n}\r\n\r\n// Alias for compatibility with cached scripts\r\nconst syncHeaderProfile = syncProfileUI;\r\nwindow.syncProfileUI = syncProfileUI; // Also export to window for debugging\r\n\r\n/**\r\n * Robust Logout Implementation\r\n */\r\nasync function handleLogout() {\r\n    if (confirm('Are you sure you want to logout?')) {\r\n        try {\r\n            await logoutUser();\r\n            window.location.href = 'index.html';\r\n        } catch (error) {\r\n            console.error('Logout failed:', error);\r\n            // Force redirect if API fails\r\n            window.location.href = 'index.html';\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Global Notifications: Unread Messages Count\r\n */\r\nasync function loadUnreadMessages(userId) {\r\n    try {\r\n        const { count, error } = await supabase\r\n            .from('messages')\r\n            .select('*', { count: 'exact', head: true })\r\n            .eq('receiver_id', userId)\r\n            .is('read_at', null);\r\n\r\n        if (error) throw error;\r\n\r\n        // Update Header Badge\r\n        const headerBadge = document.getElementById('unreadBadge');\r\n        if (headerBadge) {\r\n            headerBadge.textContent = count || 0;\r\n            headerBadge.style.display = count > 0 ? 'flex' : 'none';\r\n        }\r\n\r\n        // Update Dashboard Metric Card\r\n        const metricCount = document.getElementById('countMessages');\r\n        if (metricCount) {\r\n            metricCount.textContent = count || 0;\r\n        }\r\n\r\n        // Update Sidebar Badge (if exists)\r\n        const sidebarLink = document.querySelector('a[href=\"messages.html\"]');\r\n        if (sidebarLink && count > 0) {\r\n            let badge = sidebarLink.querySelector('.sidebar-badge');\r\n            if (!badge) {\r\n                badge = document.createElement('span');\r\n                badge.className = 'sidebar-badge';\r\n                badge.style = \"background: #E63946; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; margin-left: auto; font-weight: 700;\";\r\n                sidebarLink.appendChild(badge);\r\n            }\r\n            badge.textContent = count;\r\n        } else if (sidebarLink) {\r\n            const badge = sidebarLink.querySelector('.sidebar-badge');\r\n            if (badge) badge.remove();\r\n        }\r\n\r\n    } catch (err) {\r\n        console.error('Error loading unread count:', err);\r\n    }\r\n}\r\n\r\nfunction subscribeToNewMessages(userId) {\r\n    supabase\r\n        .channel('global-unread-sync')\r\n        .on('postgres_changes', {\r\n            event: '*',\r\n            schema: 'public',\r\n            table: 'messages',\r\n            filter: `receiver_id=eq.${userId}`\r\n        }, () => {\r\n            loadUnreadMessages(userId);\r\n        })\r\n        .subscribe();\r\n}\r\n"],"names":["updateDate","initDashboard","setupSidebar","dateEl","now","options","user","getCurrentUser","syncProfileUI","loadCounts","loadActivityFeeds","loadMyListings","setupRealtimeListings","loadUnreadMessages","subscribeToNewMessages","userId","listEl","badgeEl","listings","error","supabase","mainCountEl","item","err","payload","listingCount","feed1","feed2","notifFeed","activityData","notifData","renderActivityItem","renderNotifItem","sidebar","currentPath","link","e","handleLogout","href","session","profileToggle","existingUser","applyUpdates","first","_a","last","_b","uname","_c","email","phone","displayId","fullDisplay","avatarSrc","el","avatarImg","wrapper","newImg","label","input","style","usernameInput","feedback","btnDiv","saveBtn","originalName","val","valid","newName","logoutUser","count","headerBadge","metricCount","sidebarLink","badge"],"mappings":"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"}