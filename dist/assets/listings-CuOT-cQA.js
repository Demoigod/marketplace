import{i as m,s as c,g as u,b as f}from"./auth-DlafXHy2.js";/* empty css              *//* empty css               */import{i as p,f as g,c as l}from"./save-item-CklIikd3.js";document.addEventListener("DOMContentLoaded",async()=>{if(!await m()){window.location.href="index.html";return}h(),y(),w(),p(),c.auth.onAuthStateChange(t=>{t==="SIGNED_OUT"&&(window.location.href="index.html")})});async function h(){const e=await u();if(e){const t=document.querySelectorAll(".admin-name"),a=e.username||e.full_name||"User";t.forEach(n=>n.textContent=a),document.querySelectorAll(".avatar").forEach(n=>{n.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=368CBF&color=fff`})}}async function y(){const e=document.getElementById("marketplaceGrid");if(e)try{const t=await g(),a=!0;t&&t.length>0?e.innerHTML=t.map(i=>l(i,a)).join(""):e.innerHTML='<div class="empty-state" style="padding: 60px; text-align: center; grid-column: 1/-1;"><p style="color: var(--text-secondary); font-size: 1.1rem;">No items found in the marketplace.</p></div>'}catch(t){console.error("Error loading marketplace:",t.message),e.innerHTML='<p class="error-state">Failed to load listings. Please try again later.</p>'}}function w(){const e=document.getElementById("listingsSearch");e&&e.addEventListener("input",v(async i=>{const n=i.target.value.toLowerCase(),o=document.getElementById("marketplaceGrid"),{data:s}=await c.from("market_listings").select("*").or(`title.ilike.%${n}%,description.ilike.%${n}%`).eq("status","active");o&&(o.innerHTML=(s||[]).map(r=>l(r,!0)).join(""))},300));const t=document.getElementById("marketplaceGrid");t&&t.addEventListener("click",async i=>{const n=i.target.closest("button");if(!n)return;const o=n.dataset.action,s=n.dataset.id;if(o==="buy")window.location.href=`payment.html?item_id=${s}`;else if(o==="contact"){const r=n.dataset.sellerId,d=n.dataset.id;window.location.href=`messages.html?partner_id=${r}&item_id=${d}`}else o==="view"&&(window.location.href=`item.html?id=${s}`)});const a=document.querySelector(".logout-btn");a&&a.addEventListener("click",async()=>{confirm("Are you sure you want to logout?")&&(await f(),window.location.href="index.html")})}function v(e,t){let a;return function(...i){clearTimeout(a),a=setTimeout(()=>e.apply(this,i),t)}}
