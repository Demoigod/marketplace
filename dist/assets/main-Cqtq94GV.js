import{i as c,s as d,g as w,l as k,r as M,a as C}from"./auth-DlafXHy2.js";/* empty css               */import{i as b}from"./navbar-CyDIn5Kq.js";import{i as A,f as S,c as m}from"./save-item-D_o1zDvr.js";let u="all",E=[];const g=document.getElementById("uploadModal");document.getElementById("resourceModal");const f=document.getElementById("authModal");document.getElementById("postItemBtn");document.getElementById("uploadResourceBtn");document.getElementById("uploadForm");const p=document.getElementById("resourceForm"),y=document.getElementById("loginForm"),v=document.getElementById("registerForm"),T=document.getElementById("searchInput"),a=document.getElementById("marketplaceGrid"),i=document.getElementById("resourcesGrid");document.getElementById("loginBtn");document.getElementById("dashboardLink");document.addEventListener("DOMContentLoaded",async()=>{if(await b(),await H(),await c()){window.location.href="admin.html";return}I(),B(),A(),new URLSearchParams(window.location.search).get("action")==="post"&&setTimeout(()=>{document.dispatchEvent(new CustomEvent("open-post-modal"))},800),D(),d.auth.onAuthStateChange((e,n)=>{e==="SIGNED_OUT"?window.location.href="index.html":e==="SIGNED_IN"&&window.location.pathname.endsWith("index.html")&&(window.location.href="admin.html")})});async function H(){const t=await w(),o=document.getElementById("heroAuthCtas");t?o&&(o.style.display="none"):(o&&(o.style.display="flex"),x())}function x(){const t=document.getElementById("heroSignupBtn"),o=document.getElementById("heroLoginBtn"),e=document.getElementById("authModal");t&&e&&(t.onclick=()=>{var n;(n=document.querySelector('.auth-tab[data-tab="register"]'))==null||n.click(),e.classList.add("active")}),o&&(o.onclick=()=>{const n=document.getElementById("marketplace");n&&n.scrollIntoView({behavior:"smooth"})})}async function I(){const t=await c(),o=await S();a&&(o&&o.length>0?a.innerHTML=o.map(e=>m(e,t)).join(""):a.innerHTML='<p class="empty-state">No items found. Be the first to post!</p>')}document.addEventListener("item-posted",I);async function B(){if(i)try{const{data:t,error:o}=await d.from("free_resources").select("*").order("created_at",{ascending:!1});if(o)throw o;E=t||[],L()}catch(t){console.error("Error fetching resources:",t.message),i.innerHTML='<p class="error-state">Failed to load resources.</p>'}}function L(){if(!i)return;const t=E.filter(o=>u==="all"?!0:o.type===u);if(t.length===0){i.innerHTML='<p class="empty-state">No resources found.</p>';return}i.innerHTML=t.map(o=>F(o)).join("")}function F(t){const o={exam:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/></svg>',textbook:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor" stroke-width="2"/></svg>',notes:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke="currentColor" stroke-width="2"/></svg>'};return`
        <div class="resource-card" data-id="${t.id}">
            <div class="resource-header">
                <div class="resource-icon">
                    ${o[t.type]||o.exam}
                </div>
                <div class="resource-info">
                    <span class="resource-type">${t.type}</span>
                    <h3 class="resource-title">${t.title}</h3>
                    <p class="resource-course">${t.course}</p>
                </div>
            </div>
            <div class="resource-meta">
                <span class="resource-year">${t.year}</span>
                <button class="download-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 11V3M8 11L5 8M8 11L11 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 13H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Download
                </button>
            </div>
        </div>
    `}function D(){const t=document.getElementById("navSearchInput")||T;t&&t.addEventListener("input",$(q,300)),document.querySelectorAll(".category-chip").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".category-chip").forEach(s=>s.classList.remove("active")),e.classList.add("active");const n=e.dataset.category;N(n)})}),document.querySelectorAll(".resource-chip").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".resource-chip").forEach(n=>n.classList.remove("active")),e.classList.add("active"),u=e.dataset.type,L()})}),y&&y.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("loginEmail").value,s=document.getElementById("loginPassword").value,r=await k(n,s);r.success?window.location.href="admin.html":alert(r.message)}),v&&v.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("registerName").value,s=document.getElementById("registerEmail").value,r=document.getElementById("registerPassword").value,l=document.getElementById("registerRole").value,h=await M(s,r,n,l);h.success?window.location.href="admin.html":alert(h.message)}),p&&p.addEventListener("submit",R),a&&a.addEventListener("click",async e=>{const n=e.target.closest("button");if(!n)return;const s=n.dataset.action,r=n.dataset.id;if(s==="buy")window.location.href=`payment.html?item_id=${r}`;else if(s==="contact"){const l=n.dataset.sellerId;window.location.href=`messages.html?partner_id=${l}`}else s==="view"&&(await c()?window.location.href=`item.html?id=${r}`:document.dispatchEvent(new CustomEvent("open-auth-modal")))}),i&&i.addEventListener("click",e=>{const n=e.target.closest(".download-btn");if(n){const s=n.closest(".resource-card");s&&_(s.dataset.id)}}),document.addEventListener("open-auth-modal",()=>{f&&f.classList.add("active")}),document.addEventListener("open-post-modal",()=>{g&&g.classList.add("active")}),document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".modal").forEach(n=>n.classList.remove("active"))})}),window.addEventListener("click",e=>{e.target.classList.contains("modal")&&e.target.classList.remove("active")});const o=document.querySelectorAll(".auth-tab");o.forEach(e=>{e.addEventListener("click",()=>{o.forEach(s=>s.classList.remove("active")),e.classList.add("active"),e.dataset.tab==="login"?(document.getElementById("loginForm").style.display="block",document.getElementById("registerForm").style.display="none",document.getElementById("authModalTitle").textContent="Login"):(document.getElementById("loginForm").style.display="none",document.getElementById("registerForm").style.display="block",document.getElementById("authModalTitle").textContent="Register")})})}async function R(t){if(t.preventDefault(),!await c()){alert("Please login to upload resources.");return}const o=await w(),e={title:document.getElementById("resourceTitle").value,type:document.getElementById("resourceType").value,course:document.getElementById("resourceCourse").value,year:parseInt(document.getElementById("resourceYear").value)||new Date().getFullYear(),description:document.getElementById("resourceDescription").value,uploader_id:o.id},{error:n}=await d.from("free_resources").insert([e]);n?alert("Error uploading resource: "+n.message):(alert("Resource uploaded!"),document.getElementById("resourceModal").classList.remove("active"),B())}async function _(t){if(!await c()){document.dispatchEvent(new CustomEvent("open-auth-modal"));return}await C({id:t}),alert("Download started!")}function $(t,o){let e;return function(...n){clearTimeout(e),e=setTimeout(()=>t.apply(this,n),o)}}async function q(t){const o=t.target.value.toLowerCase(),{data:e}=await d.from("market_listings").select("*").or(`title.ilike.%${o}%,description.ilike.%${o}%`).eq("status","active"),n=await c();a&&(a.innerHTML=(e||[]).map(s=>m(s,n)).join(""))}async function N(t){const o=await c(),{data:e}=await d.from("market_listings").select("*").order("created_at",{ascending:!1}),n=t==="all"?e:e.filter(s=>s.category===t);a&&(a.innerHTML=(n||[]).map(s=>m(s,o)).join(""))}
