{"version":3,"file":"my-listings-DHqzxQQi.js","sources":["../../my-listings.js","../../my-listings.html?html-proxy&index=3.js"],"sourcesContent":["import { supabase } from './supabase-config.js';\r\nimport { isLoggedIn, getCurrentUser } from './auth.js';\r\nimport './admin.js'; // Ensure sidebar injection/logic\r\n\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    // Auth check\r\n    const user = await getCurrentUser();\r\n    if (!user) {\r\n        window.location.href = 'index.html';\r\n        return;\r\n    }\r\n\r\n    await loadMyListings(user.id);\r\n});\r\n\r\nasync function loadMyListings(userId) {\r\n    const grid = document.getElementById('myListingsGrid');\r\n\r\n    try {\r\n        const { data: listings, error } = await supabase\r\n            .from('market_listings')\r\n            .select('*')\r\n            .eq('seller_id', userId)\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        if (!listings || listings.length === 0) {\r\n            grid.innerHTML = `\r\n                <div style=\"grid-column: 1/-1; text-align: center; padding: 4rem;\">\r\n                    <h3>No listings found</h3>\r\n                    <p>You haven't listed any items for sale yet.</p>\r\n                    <a href=\"post-item.html\" class=\"btn-primary\" style=\"display: inline-block; margin-top: 1rem; text-decoration: none;\">Post an Item</a>\r\n                </div>\r\n            `;\r\n            return;\r\n        }\r\n\r\n        grid.innerHTML = listings.map(item => createMyListingCard(item)).join('');\r\n\r\n        // Attach event listeners for status changes\r\n        document.querySelectorAll('.status-select').forEach(select => {\r\n            select.addEventListener('change', async (e) => {\r\n                const itemId = e.target.dataset.id;\r\n                const newStatus = e.target.value;\r\n                await updateListingStatus(itemId, newStatus);\r\n            });\r\n        });\r\n\r\n        document.querySelectorAll('.delete-btn').forEach(btn => {\r\n            btn.addEventListener('click', async (e) => {\r\n                const itemId = e.target.dataset.id;\r\n                if (confirm('Are you sure you want to delete this listing? It cannot be undone.')) {\r\n                    await deleteListing(itemId);\r\n                }\r\n            });\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error('Error loading my listings:', err);\r\n        grid.innerHTML = '<div style=\"color: red; padding: 2rem;\">Error loading listings. Please refresh.</div>';\r\n    }\r\n}\r\n\r\nfunction createMyListingCard(item) {\r\n    // Handle image parsing\r\n    let imageUrl = 'https://via.placeholder.com/300x200?text=No+Image';\r\n    if (item.images && Array.isArray(item.images) && item.images.length > 0) {\r\n        imageUrl = item.images[0];\r\n    } else if (typeof item.images === 'string' && item.images.startsWith('[')) {\r\n        try {\r\n            const parsed = JSON.parse(item.images);\r\n            if (parsed.length > 0) imageUrl = parsed[0];\r\n        } catch (e) { }\r\n    }\r\n\r\n    return `\r\n        <div class=\"item-card\" id=\"card-${item.id}\">\r\n            <div class=\"card-image\">\r\n                <img src=\"${imageUrl}\" alt=\"${item.title}\" loading=\"lazy\">\r\n                <span class=\"price-tag\">R ${item.price}</span>\r\n            </div>\r\n            <div class=\"card-content\">\r\n                <h3 class=\"item-title\">${item.title}</h3>\r\n                <p class=\"item-meta\">${item.category} ‚Ä¢ ${new Date(item.created_at).toLocaleDateString()}</p>\r\n                \r\n                <div class=\"status-actions\">\r\n                    <select class=\"status-select\" data-id=\"${item.id}\">\r\n                        <option value=\"active\" ${item.status === 'active' ? 'selected' : ''}>Active üü¢</option>\r\n                        <option value=\"sold\" ${item.status === 'sold' ? 'selected' : ''}>Sold üî¥</option>\r\n                        <option value=\"pending\" ${item.status === 'pending' ? 'selected' : ''}>Pending üü°</option>\r\n                    </select>\r\n                    <button class=\"delete-btn\" data-id=\"${item.id}\">üóëÔ∏è</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\nasync function updateListingStatus(itemId, newStatus) {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('market_listings')\r\n            .update({ status: newStatus })\r\n            .eq('id', itemId);\r\n\r\n        if (error) throw error;\r\n        alert(`Status updated to ${newStatus}`);\r\n    } catch (err) {\r\n        console.error('Failed to update status:', err);\r\n        alert('Failed to update status.');\r\n    }\r\n}\r\n\r\nasync function deleteListing(itemId) {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('market_listings')\r\n            .delete()\r\n            .eq('id', itemId);\r\n\r\n        if (error) throw error;\r\n\r\n        // Remove from DOM\r\n        const card = document.getElementById(`card-${itemId}`);\r\n        if (card) card.remove();\r\n\r\n        alert('Listing deleted.');\r\n    } catch (err) {\r\n        console.error('Failed to delete:', err);\r\n        alert('Failed to delete listing.');\r\n    }\r\n}\r\n","\n        import { getCurrentUser } from './auth.js';\n\n        // Protect My Listings Page\n        (async () => {\n            const user = await getCurrentUser();\n            if (!user || user.role !== 'seller') {\n                window.location.href = 'index.html';\n            }\n        })();\n    "],"names":["user","getCurrentUser","loadMyListings","userId","grid","listings","error","supabase","item","createMyListingCard","select","e","itemId","newStatus","updateListingStatus","btn","deleteListing","err","imageUrl","parsed","card"],"mappings":"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"}