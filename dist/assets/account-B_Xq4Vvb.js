import{b as h,s}from"./auth-B4SlU3WG.js";import"./admin-Chfn7G1P.js";document.addEventListener("DOMContentLoaded",async()=>{console.log("Account page specialized logic ready."),w()});function w(){const c=document.getElementById("sidebarLogout");c&&c.addEventListener("click",async a=>{a.preventDefault(),confirm("Are you sure you want to logout?")&&(await h(),window.location.href="index.html")});const u=document.getElementById("avatarInput");u&&u.addEventListener("change",async a=>{console.log("Avatar input changed");const t=a.target.files[0];if(!t){console.log("No file selected");return}if(alert("File selected: "+t.name+" ("+Math.round(t.size/1024)+"KB). Starting upload..."),t.size>2*1024*1024){alert("File size must be less than 2MB");return}try{const r=document.querySelector(".avatar-edit-overlay"),f=r.innerHTML;r.innerHTML='<span style="font-size: 10px;">‚è≥</span>';const{data:{user:l}}=await s.auth.getUser();if(!l)throw new Error("Not authenticated");const v=t.name.split(".").pop(),g=`${Date.now()}.${v}`,m=`${l.id}/${g}`,{error:p}=await s.storage.from("avatars").upload(m,t,{upsert:!0});if(p)throw p;const{data:{publicUrl:d}}=s.storage.from("avatars").getPublicUrl(m),{error:y}=await s.from("profiles").update({avatar_url:d}).eq("id",l.id);if(y)throw y;if(window.syncProfileUI){const E={...l,avatar_url:d};document.getElementById("profileAvatar").src=d,document.getElementById("topNavAvatar").src=d,alert("Profile picture updated!")}else window.location.reload();r.innerHTML=f}catch(r){console.error("Avatar upload failed:",r),alert("Failed to update profile picture: "+r.message),document.querySelector(".avatar-edit-overlay").innerHTML=`
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                    </svg>
                `}});const o=document.getElementById("username"),e=document.getElementById("saveProfileBtn"),n=document.getElementById("usernameFeedback");let i="";o&&e&&n&&(o.removeAttribute("readonly"),o.style.cursor="text",o.style.backgroundColor="white",o.addEventListener("focus",()=>{i||(i=o.value)}),o.addEventListener("input",a=>{const t=a.target.value.trim(),r=/^[a-zA-Z0-9_]{3,20}$/.test(t);t===i?(e.style.opacity="0.5",e.style.pointerEvents="none",n.textContent="",o.style.borderColor="#d1d5db"):r?(e.style.opacity="1",e.style.pointerEvents="auto",n.textContent="Looks good! Click save to check availability.",n.style.color="green",o.style.borderColor="green"):(e.style.opacity="0.5",e.style.pointerEvents="none",n.textContent="Username must be 3-20 chars, alphanumeric or underscore.",n.style.color="red",o.style.borderColor="red")}),e.addEventListener("click",async()=>{const a=o.value.trim();e.textContent="Saving...",e.disabled=!0;try{const{data:{user:t}}=await s.auth.getUser();if(!t)throw new Error("Not authenticated");const{error:r}=await s.from("profiles").update({username:a}).eq("id",t.id);if(r)throw r.code==="23505"?new Error("This username is already taken."):r;alert("Username updated successfully!"),i=a,e.textContent="Saved",setTimeout(()=>{e.textContent="Save Changes",e.style.opacity="0.5",e.style.pointerEvents="none"},2e3),window.syncProfileUI&&(document.getElementById("profileFullName").textContent=a,document.getElementById("userName").textContent=a)}catch(t){console.error("Update failed:",t),n.textContent=t.message,n.style.color="red",o.style.borderColor="red",e.textContent="Save Changes",e.disabled=!1}}))}
