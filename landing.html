<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Market - Minimal Search</title>
    <meta name="description" content="The student marketplace for learning, selling, and growing.">
    <link rel="stylesheet" href="styles.css?v=minimal-v2">
    <link rel="stylesheet" href="minimal.css?v=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- STRICT AUTH CHECK: Redirect IMMEDIATELY if logged in -->
    <script type="module">
        import { getCurrentUser } from './auth.js?v=minimal-v2';

        async function checkAuth() {
            try {
                // Use getCurrentUser directly to match market.html's check
                // This prevents redirect loops where isLoggedIn is true but getUser is null
                const user = await getCurrentUser();

                if (user) {
                    // Logged in? Go to dashboard immediately.
                    // Unified Redirect: Everyone goes to the clean Market Page
                    window.location.replace('market.html');
                } else {
                    // Guest? Reveal the page.
                    document.body.style.display = 'block';
                }
            } catch (e) {
                console.error("Auth check failed", e);
                // Fallback: show page
                document.body.style.display = 'block';
            }
        }
        checkAuth();
    </script>
    <style>
        /* Hide body until auth check completes to prevent flash */
        body {
            display: none;
        }

        /* Landing Page Specific Overrides */
        .hero {
            padding: 100px 20px;
            text-align: center;
            background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%);
        }

        .hero h1 {
            font-size: 3rem;
            color: #111827;
            margin-bottom: 1rem;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.25rem;
            color: #4B5563;
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .search-bar-landing {
            max-width: 500px;
            margin: 0 auto 2rem;
            display: flex;
            gap: 10px;
        }

        .search-bar-landing input {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #D1D5DB;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            border: none;
            transition: transform 0.2s;
        }

        .btn-large:hover {
            transform: translateY(-2px);
        }

        .btn-primary-landing {
            background: #2563EB;
            color: white;
        }

        .btn-outline-landing {
            background: transparent;
            border: 2px solid #2563EB;
            color: #2563EB;
        }

        .feature-strip {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .grid-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .preview-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .preview-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .preview-img {
            height: 180px;
            background: #F3F4F6;
            width: 100%;
            object-fit: cover;
        }

        .preview-content {
            padding: 1.5rem;
        }

        .preview-tag {
            background: #E0F2FE;
            color: #0284C7;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 0.5rem;
        }
    </style>
</head>

<body>

    <!-- MINIMAL HEADER -->
    <header style="padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center;">
        <div class="logo"
            style="font-weight: 800; font-size: 1.5rem; color: #111827; display: flex; align-items: center; gap: 8px;">
            <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                <rect width="32" height="32" rx="8" fill="url(#gradient1)" />
                <path d="M16 8L22 14L16 20L10 14L16 8Z" fill="white" />
                <defs>
                    <linearGradient id="gradient1" x1="0" y1="0" x2="32" y2="32">
                        <stop offset="0%" stop-color="#2563EB" />
                        <stop offset="100%" stop-color="#14B8A6" />
                    </linearGradient>
                </defs>
            </svg>
            Campus Market
        </div>
        <div style="display: flex; gap: 1rem;">
            <button onclick="document.getElementById('authModal').style.display='flex'"
                style="background: none; border: none; font-weight: 600; color: #374151; cursor: pointer;">Log
                in</button>
            <button onclick="document.getElementById('authModal').style.display='flex'"
                style="background: #111827; color: white; border: none; padding: 0.5rem 1.25rem; border-radius: 20px; font-weight: 600; cursor: pointer;">Sign
                up</button>
        </div>
    </header>

    <!-- MINIMAL HERO (SEARCH CENTER) -->
    <section class="minimal-hero">
        <h1 class="minimal-title">Discover Unique Items<br>on Campus</h1>

        <div class="search-xl-container">
            <input type="text" class="search-xl-input" placeholder="Search for textbooks, furniture, electronics...">
            <button class="search-xl-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </button>
        </div>
    </section>

    <!-- MINIMAL FOOTER -->
    <footer
        style="padding: 2rem; position: fixed; bottom: 0; width: 100%; text-align: center; color: #9ca3af; font-size: 0.85rem;">
        &copy; 2026 Campus Market
    </footer>

    <!-- Auth Modal (Hidden by default) -->
    <div id="authModal" class="modal"
        style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: white; padding: 2rem; border-radius: 12px; width: 100%; max-width: 400px; position: relative;">
            <button
                onclick="document.getElementById('authModal').classList.remove('active'); document.getElementById('authModal').style.display='none'"
                style="position: absolute; right: 1rem; top: 1rem; border: none; background: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <h2 style="margin-bottom: 1.5rem;">Welcome Back</h2>

            <!-- Quick and dirty access to existing auth logic via DOM elements if needed, or simple redirect to a dedicated login page if preferred. 
                 For now, we will reuse the existing form structure embedded or fetched. 
                 To keep it simple and clean, let's just link to the logic we have. -->

            <form id="loginForm" class="upload-form">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
                    <input type="email" id="loginEmail" required
                        style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 8px;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Password</label>
                    <input type="password" id="loginPassword" required
                        style="width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 8px;">
                </div>
                <button type="submit"
                    style="width: 100%; background: #2563EB; color: white; padding: 0.75rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Log
                    In</button>
            </form>
            <p style="margin-top: 1rem; text-align: center; color: #666;">
                New here? <a href="#"
                    onclick="alert('Please implement full registration or link to register page'); return false;">Create
                    an account</a>
            </p>
        </div>
    </div>

    <!-- Logic to wire up the Modal and Auth -->
    <script type="module" src="main.js?v=minimal-v2"></script>
    <script>
        // Simple modal toggles
        const modal = document.getElementById('authModal');
        // If script.js doesn't handle this specific new modal ID, we add simple listener
        document.querySelectorAll('[onclick*="authModal"]').forEach(btn => {
            btn.onclick = (e) => {
                e.preventDefault();
                modal.style.display = 'flex';
            }
        });

        // Search Interaction - Trigger Auth
        const searchInput = document.querySelector('.search-xl-input');
        const searchBtn = document.querySelector('.search-xl-btn');

        function triggerAuthWithSearch(e) {
            e.preventDefault();
            // Visual feedback or logic could go here
            modal.style.display = 'flex';
            // Focus the login email for convenience
            setTimeout(() => document.getElementById('loginEmail')?.focus(), 100);
        }

        if (searchBtn) searchBtn.addEventListener('click', triggerAuthWithSearch);
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') triggerAuthWithSearch(e);
            });
        }
    </script>
</body>

</html>